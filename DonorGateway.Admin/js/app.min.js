//app.module.js
(function() {
        var module = angular.module('app',
            [
                //angular modules
                'ngMessages',
                'angularLocalStorage',
                'ngRoute',
                'ngAnimate',

                //third party modules
                'angular-duration-format', 
                'smart-table',
                'ui.bootstrap',
                'ngTagsInput',
                'ngFileUpload',
                'rzModule',
                'switcher',
                'gfl.textAvatar',
                'textAngular',
                'ui.bootstrap.datetimepicker',
                'angular-confirm', 
                'toastr'
            ]
        ); 

        module.config(['toastrConfig', function (toastrConfig) {
            angular.extend(toastrConfig, {
                positionClass: 'toast-bottom-right',
                newestOnTop: true,
                allowHtml: false,
                closeButton: false,
                closeHtml: '<button>&times;</button>',
                extendedTimeOut: 1000,
                iconClasses: {
                    error: 'toast-error',
                    info: 'toast-info',
                    success: 'toast-success',
                    warning: 'toast-warning'
                },
                messageClass: 'toast-message',
                onHidden: null,
                onShown: null,
                onTap: null,
                progressBar: false,
                tapToDismiss: true,
                templates: {
                    toast: 'directives/toast/toast.html',
                    progressbar: 'directives/progressbar/progressbar.html'
                },
                timeOut: 5000,
                titleClass: 'toast-title',
                toastClass: 'toast'
            });
        }]);

    }
)();
//mark.lawrence
//clear-key.directive.js

(function () {
    angular.module('app').directive("clearKey", function () {
        return {
            restrict: 'EA',
            require: 'ngModel',
            link: function (scope, el, attrs, ctrl) {
                el.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    ctrl.$setViewValue(null);
                    ctrl.$render();
                    scope.$apply();
                });
            }
        };
    });
})();
//mark.lawrence
//date-before.directive.js

(function () {
    angular.module('app').directive('dateBefore', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elem, attrs, ngModel) {
                if (!ngModel) return; // do nothing if no ng-model
                debugger;
                var dateBefore = attrs.dateBefore;
                console.log('date', dateBefore);

                // watch own value and re-validate on change
                scope.$watch(attrs.ngModel, function () {
                    validate();
                });

                // observe the other value and re-validate on change
                attrs.$observe('dateGreaterAndEqual', function (val) {
                    validate();
                });

                var validate = function () {
                    // values
                    var dateTo = angular.isDefined(ngModel.$viewValue) === true && !_.isNull(ngModel.$viewValue) ? moment(ngModel.$viewValue).toDate() : null;
                    var dateFrom = attrs.dateGreaterAndEqual !== "" ? moment(attrs.dateGreaterAndEqual.replace('"', '').replace('\\', '').replace('"', '')).toDate() : null;
                    //passing date with braces around it causes and issue therfore we need to use replace

                };
            }
        };
    });


})();
//mark.lawrence
//date-format.directive.js

(function () {
    angular.module('app')
        .directive('dateFormat',
            function (dateFilter, $parse) {
                return {
                    restrict: 'EAC',
                    require: '?ngModel',
                    link: function (scope, element, attrs, ngModel, ctrl) {
                        ngModel.$parsers.push(function (viewValue) {
                            return dateFilter(viewValue, 'MM/dd/yyyy h:mm a');
                        });
                    }
                }
            });
})();
//mark.lawrence
//date-input.directive.js

(function () {
    angular.module('app').directive('dateInput', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elm, attrs, ctrl) {
                var moment = $window.moment;
                var dateFormat = attrs.dateInput;
                attrs.$observe('dateInput', function (newValue) {
                    if (dateFormat === newValue || !ctrl.$modelValue) return;
                    dateFormat = newValue;
                    ctrl.$modelValue = new Date(ctrl.$setViewValue);
                });

                ctrl.$formatters.unshift(function (modelValue) {
                    scope = scope;
                    if (!dateFormat || !modelValue) return "";
                    var retVal = moment(modelValue).format(dateFormat);
                    return retVal;
                });

                ctrl.$parsers.unshift(function (viewValue) {
                    scope = scope;
                    var date = moment(viewValue, dateFormat);
                    return (date && date.isValid() && date.year() > 1950) ? date.toDate() : "";
                });
            }
        };
    });
})();
//mark.lawrence
//smart-table.clearKey.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: ['^stTable', '^ngModel'],
            link: function (scope, element, attrs, ctrls) {
                element.on('keydown', function (event) {
                    var ngModel = ctrls[1];
                    var ctrl = ctrls[0];

                    if (event.which === 13) {
                        return ctrl.pipe();
                    }
                    if (event.which === 27) {

                        if (element.context.attributes['st-search'] !== undefined) {
                            return scope.$apply(function () {
                                var fieldName = element.context.attributes['st-search'].value;
                                var tableState = ctrl.tableState();
                                tableState.search.predicateObject[fieldName] = '';
                                return ctrl.pipe();
                            });

                        } else {
                            return scope.$apply(function () {
                                ngModel.$setViewValue(null);
                                ngModel.$render(); // will update the input value as well
                            });

                        }
                    }
                });
            }
        };
    });

    angular.module('app')
        .directive("stResetSearch",
            function () {
                return {
                    restrict: 'EA',
                    require: ['^stTable', '^ngModel'],
                    link: function (scope, element, attrs, ctrls) {
                        return element.bind('click',
                            function () {
                                var model = ctrls[1];
                                var ctrl = ctrls[0];

                                return scope.$apply(function () {
                                    angular.forEach(model.$viewValue,
                                        function (value, key) {
                                            if (key.toLowerCase() === 'page') {
                                                model.$viewValue[key] = 1;
                                            }
                                            if (Array.isArray(value) || _.includes(key.toLowerCase(), 'page')) return;
                                            model.$viewValue[key] = null;
                                        });
                                    var tableState = ctrl.tableState();
                                    tableState.search.predicateObject = {};
                                    tableState.pagination.start = 0;
                                    return ctrl.pipe();
                                });
                            });
                    }
                };
            });

    angular.module('app').directive('stSubmitSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
        return {
            require: '^stTable',
            link: function (scope, element, attr, ctrl) {
                return element.bind('click',
                    function () {
                        var tableCtrl = ctrl;
                        tableCtrl.pipe();
                    });

            }
        };
    }]);


    angular.module('smart-table')
      .directive('stSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
          return {
              require: '^stTable',
              link: function (scope, element, attr, ctrl) {
                  var tableCtrl = ctrl;
                  var promise = null;
                  var throttle = attr.stDelay || stConfig.search.delay;
                  var event = attr.stInputEvent || stConfig.search.inputEvent;

                  attr.$observe('stSearch', function (newValue, oldValue) {
                      var input = element[0].value;
                      if (newValue !== oldValue && input) {
                          ctrl.tableState().search = {};
                          tableCtrl.search(input, newValue);
                      }
                  });

                  //table state -> view
                  scope.$watch(function () {
                      return ctrl.tableState().search;
                  }, function (newValue, oldValue) {
                      var predicateExpression = attr.stSearch || '$';
                      if (newValue.predicateObject && $parse(predicateExpression)(newValue.predicateObject) !== element[0].value) {
                          element[0].value = $parse(predicateExpression)(newValue.predicateObject) || '';
                      }
                  }, true);

                  // view -> table state
                  element.bind(event, function (evt) {
                      evt = evt.originalEvent || evt;
                      if (promise !== null) {
                          $timeout.cancel(promise);
                      }

                      promise = $timeout(function () {
                          tableCtrl.search(evt.target.value, attr.stSearch || '');
                          promise = null;
                      }, throttle);
                  });
              }
          };
      }]);

})();
(function() {


    var app = angular.module('app');

    app.directive('toggleCheckbox', function($timeout) {

        /**
     * Directive
     */
        return {
            restrict: 'A',
            transclude: true,
            replace: false,
            require: 'ngModel',
            link: function($scope, $element, $attr, ngModel) {

                // update model from Element
                var updateModelFromElement = function() {
                    // If modified
                    var checked = $element.prop('checked');
                    if (checked !== ngModel.$viewValue) {
                        // Update ngModel
                        ngModel.$setViewValue(checked);
                        $scope.$apply();
                    }
                };

                // Update input from Model
                var updateElementFromModel = function(newValue) {
                    $element.trigger('change');
                };

                // Observe: Element changes affect Model
                $element.on('change', function() {
                    updateModelFromElement();
                });

                $scope.$watch(function() {
                    return ngModel.$viewValue;
                }, function(newValue) {
                    updateElementFromModel(newValue);
                }, true);

                // Initialise BootstrapToggle
                $element.bootstrapToggle();
            }
        };
    });
})();
//mailer-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, toastr, $modal) {
        var $ctrl = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        $ctrl.title = 'MarkIt Manager';
        $ctrl.subTitle = 'Mailers';

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            //orderBy: 'campaignId',
            //orderDirection: 'desc',
            suppress: false
        };

        $ctrl.$onInit = function () {
            console.log('mail list init');
            $http.get('api/mailer/campaigns').then(function (r) {
                $ctrl.campaigns = r.data;
            });
            $http.get('api/mailer/reasons').then(function (r) {
                $ctrl.reasons = r.data;
            });
        }

        $ctrl.download = function () {
            $ctrl.isBusy = true;
            $http.post('api/mailer/export', $ctrl.searchModel)
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        console.log(ex);
                        toastr.error('Oops ' + ex.data.message);
                    }
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
        }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;
            $ctrl.isBusy = true;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                $ctrl.searchModel.orderBy = tableState.sort.predicate;
                $ctrl.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            if ($ctrl.searchModel.suppress === null) $ctrl.searchModel.suppress = false;
            return $http.get('api/mailer', { params: $ctrl.searchModel })
                .then(function (r) {
                    console.log('r', r.data);
                    $ctrl.mailers = r.data.results;
                    $ctrl.searchModel = r.data;
                    delete $ctrl.searchModel.results;
                }).catch(function (err) {
                    console.log('Oops', err.data.message);
                    toastr.error('Oops ' + err.data.message);
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
        }

        $ctrl.showUpload = function () {
            $modal.open({
                component: 'mailerUpload',
                bindings: {
                    modalInstance: "<"
                },
                size: 'md'
            }).result.then(function (result) {
                toastr.info('Uploaded ' + result.title);
            }, function (reason) {
            });
        }

        $ctrl.paged = function paged() {
            $ctrl.search(tableStateRef);
        };

        $ctrl.toggleFilter = function () {
            $ctrl.showSuppress = !$ctrl.showSuppress;
            $ctrl.searchModel.suppress = $ctrl.showSuppress;
            $ctrl.search(tableStateRef);
        }

        $ctrl.toggleSuppress = function (mailer) {
            $ctrl.isBusy = true; 
            if (mailer.suppress) {
                mailer.suppress = false;
                mailer.reasonId = null;
                $ctrl.isBusy = true;
                return $http.put('api/mailer', mailer).then(function (r) {
                    angular.extend(mailer, r.data);
                }).catch(function (err) {
                    console.log('Error saving mailer', err.message);
                    $toastr.error('Oops ' + err.data.message);
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
            } else {
                $modal.open({
                    component: 'mailerSuppress',
                    bindings: {
                        modalInstance: "<"
                    },
                    resolve: {
                        mailer: mailer
                    },
                    size: 'md'
                }).result.then(function (result) {
                    angular.extend(mailer, result);
                    toastr.info('Saved ' + result.firstName + ' ' + result.lastName);
                }, function (reason) {
                });
            }
            $ctrl.isBusy = false; 
        }
    }

    module.component('mailerList',
        {
            templateUrl: 'app/mailers/mailer-list.component.html',
            controller: ['$http', 'toastr', '$uibModal', controller]
        });
}
)();
//mailer-suppress.component.js
(function () {
    var module = angular.module('app');

    function controller($http) {
        var $ctrl = this;

        $ctrl.$onInit = function () {
            console.log('mailer suppress init');
            if ($ctrl.resolve) {
                $ctrl.mailer = $ctrl.resolve.mailer;
                $ctrl.title = $ctrl.mailer.firstName + ' ' + $ctrl.mailer.lastName;
            }

            $http.get('api/mailer/reasons').then(function (r) {
                $ctrl.reasons = r.data;
            });
        }

        $ctrl.cancel = function() {
            $ctrl.dismiss();    
        }

        $ctrl.save = function () {
            $ctrl.mailer.suppress = true; 
            return $http.put('api/mailer', $ctrl.mailer).then(function (r) {
                angular.extend($ctrl.mailer, r.data);
                $ctrl.modalInstance.close($ctrl.mailer);
            }).catch(function (err) {
                console.log('Error saving mailer', err.message);
            }).finally(function () {
            });
        }
    };

    module.component('mailerSuppress',
        {
            templateUrl: 'app/mailers/mailer-suppress.component.html',
            bindings: {
                id: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            controller: ['$http', controller]
        });
}
)();
//mailer-upload.component.js
(function () {
    var module = angular.module('app');

    function formDataObject(data) {
        var fd = new FormData();
        fd.append('file', data);
        return fd;
    }

    function controller($http, toastr) {
        var $ctrl = this;
        $ctrl.title = 'Mailer Upload';

        $ctrl.$onInit = function () {
            console.log('Mailer Upload Init');
            $http.get('api/mailer/campaigns').then(function (r) {
                $ctrl.campaigns = r.data;
            });
        }

        $ctrl.cancel = function () {
            $ctrl.file = undefined;
            $ctrl.dismiss();
        }

        $ctrl.fileSelected = function ($file, $event) {
            $ctrl.result = null;
        };

        $ctrl.saveCampaign = function () {
            console.log('save', $ctrl.campaign);
            $http.post('api/mailer/createcampaign', $ctrl.campaign).then(function (r) {
                $ctrl.campaigns.unshift(r.data);
                $ctrl.selectedCampaign = r.data;
                $ctrl.showCreate = false;
            }).catch(function (err) {
                toastr.error('Oops ' + err.data.message);
            });
        }

        $ctrl.upload = function () {
            $ctrl.isBusy = true;
            $ctrl.result = {
                success: false
            }
            var id = $ctrl.selectedCampaign.id; 

            return $http.post('api/file/mailer/' + id, formDataObject($ctrl.file), {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(function (r) {
                $ctrl.result.success = true;
                $ctrl.result.message = r.data;
            }).catch(function (error) {
                $ctrl.result.message = error.data.message;
            }).finally(function () {
                $ctrl.file = undefined;
                $ctrl.isBusy = false;
                $ctrl.result.campaigns = $ctrl.campaigns;
                $ctrl.modalInstance.close($ctrl.result);
            });

            //service.mailer(vm.selectedCampaign.id, vm.file)
            //    .then(function (data) {
            //        $ctrl.result.success = true;
            //        $ctrl.result.message = data;
            //    })
            //    .catch(function (error) {
            //        $ctrl.result.message = error.data.message;
            //    })
            //    .finally(function () {
            //        $ctrl.file = undefined;
            //        $ctrl.isBusy = false;
            //        $ctrl.result.campaigns = $ctrl.campaigns;
            //        $ctrl.modalInstance.close($ctrl.result);
            //    });
        }
    }

    module.component('mailerUpload',
        {
            bindings: {
                id: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            templateUrl: 'app/mailers/mailer-upload.component.html',
            controller: ['$http', 'toastr', controller]
        });

}
)();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJkaXJlY3RpdmVzL2NsZWFyLWtleS5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL2RhdGUtYmVmb3JlLmpzIiwiZGlyZWN0aXZlcy9kYXRlLWZvcm1hdC5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL2RhdGUtaW5wdXQuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9zbWFydC10YWJsZS5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3RvZ2dsZUNoZWNrYm94LmRpcmVjdGl2ZS5qcyIsIm1haWxlcnMvbWFpbGVyLWxpc3QuY29tcG9uZW50LmpzIiwibWFpbGVycy9tYWlsZXItc3VwcHJlc3MuY29tcG9uZW50LmpzIiwibWFpbGVycy9tYWlsZXItdXBsb2FkLmNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9hcHAubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsXHJcbiAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgIC8vYW5ndWxhciBtb2R1bGVzXHJcbiAgICAgICAgICAgICAgICAnbmdNZXNzYWdlcycsXHJcbiAgICAgICAgICAgICAgICAnYW5ndWxhckxvY2FsU3RvcmFnZScsXHJcbiAgICAgICAgICAgICAgICAnbmdSb3V0ZScsXHJcbiAgICAgICAgICAgICAgICAnbmdBbmltYXRlJyxcclxuXHJcbiAgICAgICAgICAgICAgICAvL3RoaXJkIHBhcnR5IG1vZHVsZXNcclxuICAgICAgICAgICAgICAgICdhbmd1bGFyLWR1cmF0aW9uLWZvcm1hdCcsIFxyXG4gICAgICAgICAgICAgICAgJ3NtYXJ0LXRhYmxlJyxcclxuICAgICAgICAgICAgICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgICAgICAgICAgICAgJ25nVGFnc0lucHV0JyxcclxuICAgICAgICAgICAgICAgICduZ0ZpbGVVcGxvYWQnLFxyXG4gICAgICAgICAgICAgICAgJ3J6TW9kdWxlJyxcclxuICAgICAgICAgICAgICAgICdzd2l0Y2hlcicsXHJcbiAgICAgICAgICAgICAgICAnZ2ZsLnRleHRBdmF0YXInLFxyXG4gICAgICAgICAgICAgICAgJ3RleHRBbmd1bGFyJyxcclxuICAgICAgICAgICAgICAgICd1aS5ib290c3RyYXAuZGF0ZXRpbWVwaWNrZXInLFxyXG4gICAgICAgICAgICAgICAgJ2FuZ3VsYXItY29uZmlybScsIFxyXG4gICAgICAgICAgICAgICAgJ3RvYXN0cidcclxuICAgICAgICAgICAgXVxyXG4gICAgICAgICk7IFxyXG5cclxuICAgICAgICBtb2R1bGUuY29uZmlnKFsndG9hc3RyQ29uZmlnJywgZnVuY3Rpb24gKHRvYXN0ckNvbmZpZykge1xyXG4gICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh0b2FzdHJDb25maWcsIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uQ2xhc3M6ICd0b2FzdC1ib3R0b20tcmlnaHQnLFxyXG4gICAgICAgICAgICAgICAgbmV3ZXN0T25Ub3A6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBhbGxvd0h0bWw6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY2xvc2VCdXR0b246IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY2xvc2VIdG1sOiAnPGJ1dHRvbj4mdGltZXM7PC9idXR0b24+JyxcclxuICAgICAgICAgICAgICAgIGV4dGVuZGVkVGltZU91dDogMTAwMCxcclxuICAgICAgICAgICAgICAgIGljb25DbGFzc2VzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6ICd0b2FzdC1lcnJvcicsXHJcbiAgICAgICAgICAgICAgICAgICAgaW5mbzogJ3RvYXN0LWluZm8nLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICd0b2FzdC1zdWNjZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICB3YXJuaW5nOiAndG9hc3Qtd2FybmluZydcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlQ2xhc3M6ICd0b2FzdC1tZXNzYWdlJyxcclxuICAgICAgICAgICAgICAgIG9uSGlkZGVuOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgb25TaG93bjogbnVsbCxcclxuICAgICAgICAgICAgICAgIG9uVGFwOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3NCYXI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgdGFwVG9EaXNtaXNzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9hc3Q6ICdkaXJlY3RpdmVzL3RvYXN0L3RvYXN0Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb2dyZXNzYmFyOiAnZGlyZWN0aXZlcy9wcm9ncmVzc2Jhci9wcm9ncmVzc2Jhci5odG1sJ1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRpbWVPdXQ6IDUwMDAsXHJcbiAgICAgICAgICAgICAgICB0aXRsZUNsYXNzOiAndG9hc3QtdGl0bGUnLFxyXG4gICAgICAgICAgICAgICAgdG9hc3RDbGFzczogJ3RvYXN0J1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XSk7XHJcblxyXG4gICAgfVxyXG4pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vY2xlYXIta2V5LmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoXCJjbGVhcktleVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIGVsLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoICE9PSAyNykgeyByZXR1cm47IH0gLy8gY2hlY2sga2V5IGhvdyB5b3Ugd2FudFxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZpZXdWYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRyZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2RhdGUtYmVmb3JlLmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2RhdGVCZWZvcmUnLCBmdW5jdGlvbiAoJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdebmdNb2RlbCcsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0cnMsIG5nTW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbmdNb2RlbCkgcmV0dXJuOyAvLyBkbyBub3RoaW5nIGlmIG5vIG5nLW1vZGVsXHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRlQmVmb3JlID0gYXR0cnMuZGF0ZUJlZm9yZTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkYXRlJywgZGF0ZUJlZm9yZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gd2F0Y2ggb3duIHZhbHVlIGFuZCByZS12YWxpZGF0ZSBvbiBjaGFuZ2VcclxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChhdHRycy5uZ01vZGVsLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIG9ic2VydmUgdGhlIG90aGVyIHZhbHVlIGFuZCByZS12YWxpZGF0ZSBvbiBjaGFuZ2VcclxuICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCdkYXRlR3JlYXRlckFuZEVxdWFsJywgZnVuY3Rpb24gKHZhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdmFsdWVzXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVUbyA9IGFuZ3VsYXIuaXNEZWZpbmVkKG5nTW9kZWwuJHZpZXdWYWx1ZSkgPT09IHRydWUgJiYgIV8uaXNOdWxsKG5nTW9kZWwuJHZpZXdWYWx1ZSkgPyBtb21lbnQobmdNb2RlbC4kdmlld1ZhbHVlKS50b0RhdGUoKSA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGVGcm9tID0gYXR0cnMuZGF0ZUdyZWF0ZXJBbmRFcXVhbCAhPT0gXCJcIiA/IG1vbWVudChhdHRycy5kYXRlR3JlYXRlckFuZEVxdWFsLnJlcGxhY2UoJ1wiJywgJycpLnJlcGxhY2UoJ1xcXFwnLCAnJykucmVwbGFjZSgnXCInLCAnJykpLnRvRGF0ZSgpIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAvL3Bhc3NpbmcgZGF0ZSB3aXRoIGJyYWNlcyBhcm91bmQgaXQgY2F1c2VzIGFuZCBpc3N1ZSB0aGVyZm9yZSB3ZSBuZWVkIHRvIHVzZSByZXBsYWNlXHJcblxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcblxyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2RhdGUtZm9ybWF0LmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2RhdGVGb3JtYXQnLFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZGF0ZUZpbHRlciwgJHBhcnNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRUFDJyxcclxuICAgICAgICAgICAgICAgICAgICByZXF1aXJlOiAnP25nTW9kZWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uICh2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlRmlsdGVyKHZpZXdWYWx1ZSwgJ01NL2RkL3l5eXkgaDptbSBhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZGF0ZS1pbnB1dC5kaXJlY3RpdmUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdkYXRlSW5wdXQnLCBmdW5jdGlvbiAoJHdpbmRvdykge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdebmdNb2RlbCcsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vbWVudCA9ICR3aW5kb3cubW9tZW50O1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGVGb3JtYXQgPSBhdHRycy5kYXRlSW5wdXQ7XHJcbiAgICAgICAgICAgICAgICBhdHRycy4kb2JzZXJ2ZSgnZGF0ZUlucHV0JywgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVGb3JtYXQgPT09IG5ld1ZhbHVlIHx8ICFjdHJsLiRtb2RlbFZhbHVlKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZUZvcm1hdCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJG1vZGVsVmFsdWUgPSBuZXcgRGF0ZShjdHJsLiRzZXRWaWV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY3RybC4kZm9ybWF0dGVycy51bnNoaWZ0KGZ1bmN0aW9uIChtb2RlbFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUgPSBzY29wZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGVGb3JtYXQgfHwgIW1vZGVsVmFsdWUpIHJldHVybiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSBtb21lbnQobW9kZWxWYWx1ZSkuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjdHJsLiRwYXJzZXJzLnVuc2hpZnQoZnVuY3Rpb24gKHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlID0gc2NvcGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBtb21lbnQodmlld1ZhbHVlLCBkYXRlRm9ybWF0KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGRhdGUgJiYgZGF0ZS5pc1ZhbGlkKCkgJiYgZGF0ZS55ZWFyKCkgPiAxOTUwKSA/IGRhdGUudG9EYXRlKCkgOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vc21hcnQtdGFibGUuY2xlYXJLZXkuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwic3RDbGVhcktleVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFsnXnN0VGFibGUnLCAnXm5nTW9kZWwnXSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybHMpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmdNb2RlbCA9IGN0cmxzWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdHJsID0gY3RybHNbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDI3KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZE5hbWUgPSBlbGVtZW50LmNvbnRleHQuYXR0cmlidXRlc1snc3Qtc2VhcmNoJ10udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlU3RhdGUgPSBjdHJsLnRhYmxlU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3RbZmllbGROYW1lXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRyZW5kZXIoKTsgLy8gd2lsbCB1cGRhdGUgdGhlIGlucHV0IHZhbHVlIGFzIHdlbGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoXCJzdFJlc2V0U2VhcmNoXCIsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZTogWydec3RUYWJsZScsICdebmdNb2RlbCddLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG1vZGVsLiR2aWV3VmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gJ3BhZ2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLiR2aWV3VmFsdWVba2V5XSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBfLmluY2x1ZGVzKGtleS50b0xvd2VyQ2FzZSgpLCAncGFnZScpKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuJHZpZXdWYWx1ZVtrZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5wYWdpbmF0aW9uLnN0YXJ0ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnc3RTdWJtaXRTZWFyY2gnLCBbJ3N0Q29uZmlnJywgJyR0aW1lb3V0JywgJyRwYXJzZScsIGZ1bmN0aW9uIChzdENvbmZpZywgJHRpbWVvdXQsICRwYXJzZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdec3RUYWJsZScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuYmluZCgnY2xpY2snLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlQ3RybCA9IGN0cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlQ3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuXHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NtYXJ0LXRhYmxlJylcclxuICAgICAgLmRpcmVjdGl2ZSgnc3RTZWFyY2gnLCBbJ3N0Q29uZmlnJywgJyR0aW1lb3V0JywgJyRwYXJzZScsIGZ1bmN0aW9uIChzdENvbmZpZywgJHRpbWVvdXQsICRwYXJzZSkge1xyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgdGFibGVDdHJsID0gY3RybDtcclxuICAgICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgdGhyb3R0bGUgPSBhdHRyLnN0RGVsYXkgfHwgc3RDb25maWcuc2VhcmNoLmRlbGF5O1xyXG4gICAgICAgICAgICAgICAgICB2YXIgZXZlbnQgPSBhdHRyLnN0SW5wdXRFdmVudCB8fCBzdENvbmZpZy5zZWFyY2guaW5wdXRFdmVudDtcclxuXHJcbiAgICAgICAgICAgICAgICAgIGF0dHIuJG9ic2VydmUoJ3N0U2VhcmNoJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGlucHV0ID0gZWxlbWVudFswXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUgJiYgaW5wdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjdHJsLnRhYmxlU3RhdGUoKS5zZWFyY2ggPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwuc2VhcmNoKGlucHV0LCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgLy90YWJsZSBzdGF0ZSAtPiB2aWV3XHJcbiAgICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC50YWJsZVN0YXRlKCkuc2VhcmNoO1xyXG4gICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJlZGljYXRlRXhwcmVzc2lvbiA9IGF0dHIuc3RTZWFyY2ggfHwgJyQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlLnByZWRpY2F0ZU9iamVjdCAmJiAkcGFyc2UocHJlZGljYXRlRXhwcmVzc2lvbikobmV3VmFsdWUucHJlZGljYXRlT2JqZWN0KSAhPT0gZWxlbWVudFswXS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0udmFsdWUgPSAkcGFyc2UocHJlZGljYXRlRXhwcmVzc2lvbikobmV3VmFsdWUucHJlZGljYXRlT2JqZWN0KSB8fCAnJztcclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAvLyB2aWV3IC0+IHRhYmxlIHN0YXRlXHJcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZChldmVudCwgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgZXZ0ID0gZXZ0Lm9yaWdpbmFsRXZlbnQgfHwgZXZ0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHByb21pc2UgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwocHJvbWlzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9ICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwuc2VhcmNoKGV2dC50YXJnZXQudmFsdWUsIGF0dHIuc3RTZWFyY2ggfHwgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfSwgdGhyb3R0bGUpO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICB9XSk7XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuXHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBhcHAuZGlyZWN0aXZlKCd0b2dnbGVDaGVja2JveCcsIGZ1bmN0aW9uKCR0aW1lb3V0KSB7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICogRGlyZWN0aXZlXHJcbiAgICAgKi9cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICByZXBsYWNlOiBmYWxzZSxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50LCAkYXR0ciwgbmdNb2RlbCkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBtb2RlbCBmcm9tIEVsZW1lbnRcclxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVNb2RlbEZyb21FbGVtZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbW9kaWZpZWRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZCA9ICRlbGVtZW50LnByb3AoJ2NoZWNrZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZCAhPT0gbmdNb2RlbC4kdmlld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBuZ01vZGVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShjaGVja2VkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIGlucHV0IGZyb20gTW9kZWxcclxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVFbGVtZW50RnJvbU1vZGVsID0gZnVuY3Rpb24obmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAkZWxlbWVudC50cmlnZ2VyKCdjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gT2JzZXJ2ZTogRWxlbWVudCBjaGFuZ2VzIGFmZmVjdCBNb2RlbFxyXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsRnJvbUVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5nTW9kZWwuJHZpZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRWxlbWVudEZyb21Nb2RlbChuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXNlIEJvb3RzdHJhcFRvZ2dsZVxyXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQuYm9vdHN0cmFwVG9nZ2xlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLy9tYWlsZXItbGlzdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgdG9hc3RyLCAkbW9kYWwpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG4gICAgICAgIHZhciBwYWdlU2l6ZURlZmF1bHQgPSAxMDtcclxuXHJcbiAgICAgICAgJGN0cmwudGl0bGUgPSAnTWFya0l0IE1hbmFnZXInO1xyXG4gICAgICAgICRjdHJsLnN1YlRpdGxlID0gJ01haWxlcnMnO1xyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdCxcclxuICAgICAgICAgICAgLy9vcmRlckJ5OiAnY2FtcGFpZ25JZCcsXHJcbiAgICAgICAgICAgIC8vb3JkZXJEaXJlY3Rpb246ICdkZXNjJyxcclxuICAgICAgICAgICAgc3VwcHJlc3M6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ21haWwgbGlzdCBpbml0Jyk7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL21haWxlci9jYW1wYWlnbnMnKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5jYW1wYWlnbnMgPSByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9tYWlsZXIvcmVhc29ucycpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnJlYXNvbnMgPSByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZG93bmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJ2FwaS9tYWlsZXIvZXhwb3J0JywgJGN0cmwuc2VhcmNoTW9kZWwpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50VHlwZSA9IGRhdGEuaGVhZGVycygpWydjb250ZW50LXR5cGUnXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSBkYXRhLmhlYWRlcnMoKVsneC1maWxlbmFtZSddO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGlua0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbZGF0YS5kYXRhXSwgeyB0eXBlOiBjb250ZW50VHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCdocmVmJywgdXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKFwiZG93bmxvYWRcIiwgZmlsZW5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsaWNrRXZlbnQgPSBuZXcgTW91c2VFdmVudChcImNsaWNrXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmlld1wiOiB3aW5kb3csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImJ1YmJsZXNcIjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2FuY2VsYWJsZVwiOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlua0VsZW1lbnQuZGlzcGF0Y2hFdmVudChjbGlja0V2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcyAnICsgZXguZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlKSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbC5vcmRlckRpcmVjdGlvbiA9IHRhYmxlU3RhdGUuc29ydC5yZXZlcnNlID8gJ2Rlc2MnIDogJ2FzYyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICgkY3RybC5zZWFyY2hNb2RlbC5zdXBwcmVzcyA9PT0gbnVsbCkgJGN0cmwuc2VhcmNoTW9kZWwuc3VwcHJlc3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL21haWxlcicsIHsgcGFyYW1zOiAkY3RybC5zZWFyY2hNb2RlbCB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncicsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwubWFpbGVycyA9IHIuZGF0YS5yZXN1bHRzO1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkY3RybC5zZWFyY2hNb2RlbC5yZXN1bHRzO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPb3BzJywgZXJyLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdPb3BzICcgKyBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zaG93VXBsb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdtYWlsZXJVcGxvYWQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1VwbG9hZGVkICcgKyByZXN1bHQudGl0bGUpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwucGFnZWQgPSBmdW5jdGlvbiBwYWdlZCgpIHtcclxuICAgICAgICAgICAgJGN0cmwuc2VhcmNoKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRjdHJsLnRvZ2dsZUZpbHRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuc2hvd1N1cHByZXNzID0gISRjdHJsLnNob3dTdXBwcmVzcztcclxuICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwuc3VwcHJlc3MgPSAkY3RybC5zaG93U3VwcHJlc3M7XHJcbiAgICAgICAgICAgICRjdHJsLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnRvZ2dsZVN1cHByZXNzID0gZnVuY3Rpb24gKG1haWxlcikge1xyXG4gICAgICAgICAgICAkY3RybC5pc0J1c3kgPSB0cnVlOyBcclxuICAgICAgICAgICAgaWYgKG1haWxlci5zdXBwcmVzcykge1xyXG4gICAgICAgICAgICAgICAgbWFpbGVyLnN1cHByZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBtYWlsZXIucmVhc29uSWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJ2FwaS9tYWlsZXInLCBtYWlsZXIpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChtYWlsZXIsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHNhdmluZyBtYWlsZXInLCBlcnIubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRvYXN0ci5lcnJvcignT29wcyAnICsgZXJyLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ21haWxlclN1cHByZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWlsZXI6IG1haWxlclxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKG1haWxlciwgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbygnU2F2ZWQgJyArIHJlc3VsdC5maXJzdE5hbWUgKyAnICcgKyByZXN1bHQubGFzdE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7IFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdtYWlsZXJMaXN0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21haWxlcnMvbWFpbGVyLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgJ3RvYXN0cicsICckdWliTW9kYWwnLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG59XHJcbikoKTsiLCIvL21haWxlci1zdXBwcmVzcy5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtYWlsZXIgc3VwcHJlc3MgaW5pdCcpO1xyXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubWFpbGVyID0gJGN0cmwucmVzb2x2ZS5tYWlsZXI7XHJcbiAgICAgICAgICAgICAgICAkY3RybC50aXRsZSA9ICRjdHJsLm1haWxlci5maXJzdE5hbWUgKyAnICcgKyAkY3RybC5tYWlsZXIubGFzdE5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL21haWxlci9yZWFzb25zJykudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucmVhc29ucyA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpOyAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLm1haWxlci5zdXBwcmVzcyA9IHRydWU7IFxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCdhcGkvbWFpbGVyJywgJGN0cmwubWFpbGVyKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5tYWlsZXIsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLm1haWxlcik7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgbWFpbGVyJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdtYWlsZXJTdXBwcmVzcycsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tYWlsZXJzL21haWxlci1zdXBwcmVzcy5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICBpZDogJzwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxyXG4gICAgICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgICAgIGRpc21pc3M6ICcmJyxcclxuICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6ICc8J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgY29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxufVxyXG4pKCk7IiwiLy9tYWlsZXItdXBsb2FkLmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBmb3JtRGF0YU9iamVjdChkYXRhKSB7XHJcbiAgICAgICAgdmFyIGZkID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgZmQuYXBwZW5kKCdmaWxlJywgZGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGZkO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsIHRvYXN0cikge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcbiAgICAgICAgJGN0cmwudGl0bGUgPSAnTWFpbGVyIFVwbG9hZCc7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNYWlsZXIgVXBsb2FkIEluaXQnKTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvbWFpbGVyL2NhbXBhaWducycpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmNhbXBhaWducyA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmZpbGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgkZmlsZSwgJGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRjdHJsLnJlc3VsdCA9IG51bGw7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJGN0cmwuc2F2ZUNhbXBhaWduID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2F2ZScsICRjdHJsLmNhbXBhaWduKTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL21haWxlci9jcmVhdGVjYW1wYWlnbicsICRjdHJsLmNhbXBhaWduKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5jYW1wYWlnbnMudW5zaGlmdChyLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc2VsZWN0ZWRDYW1wYWlnbiA9IHIuZGF0YTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnNob3dDcmVhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdPb3BzICcgKyBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC51cGxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRjdHJsLnJlc3VsdCA9IHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGlkID0gJGN0cmwuc2VsZWN0ZWRDYW1wYWlnbi5pZDsgXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL2ZpbGUvbWFpbGVyLycgKyBpZCwgZm9ybURhdGFPYmplY3QoJGN0cmwuZmlsZSksIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHksXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWQgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5yZXN1bHQuc3VjY2VzcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5yZXN1bHQubWVzc2FnZSA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5yZXN1bHQubWVzc2FnZSA9IGVycm9yLmRhdGEubWVzc2FnZTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5maWxlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5yZXN1bHQuY2FtcGFpZ25zID0gJGN0cmwuY2FtcGFpZ25zO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZSgkY3RybC5yZXN1bHQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vc2VydmljZS5tYWlsZXIodm0uc2VsZWN0ZWRDYW1wYWlnbi5pZCwgdm0uZmlsZSlcclxuICAgICAgICAgICAgLy8gICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICRjdHJsLnJlc3VsdC5zdWNjZXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gICAgICAgICRjdHJsLnJlc3VsdC5tZXNzYWdlID0gZGF0YTtcclxuICAgICAgICAgICAgLy8gICAgfSlcclxuICAgICAgICAgICAgLy8gICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgJGN0cmwucmVzdWx0Lm1lc3NhZ2UgPSBlcnJvci5kYXRhLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgIC8vICAgIH0pXHJcbiAgICAgICAgICAgIC8vICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICRjdHJsLmZpbGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy8gICAgICAgICRjdHJsLnJlc3VsdC5jYW1wYWlnbnMgPSAkY3RybC5jYW1wYWlnbnM7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnJlc3VsdCk7XHJcbiAgICAgICAgICAgIC8vICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdtYWlsZXJVcGxvYWQnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgIGlkOiAnPCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICAgICAgZGlzbWlzczogJyYnLFxyXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21haWxlcnMvbWFpbGVyLXVwbG9hZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAndG9hc3RyJywgY29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxuXHJcbn1cclxuKSgpOyJdfQ==
