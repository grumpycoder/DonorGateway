//app.module.js
(function() {
        var module = angular.module('app',
            [
                //angular modules
                'ngMessages',
                'angularLocalStorage',
                'ngRoute',
                'ngAnimate',

                //third party modules
                'angular-duration-format', 
                'smart-table',
                'ui.bootstrap',
                'ngTagsInput',
                'ngFileUpload',
                'ngFileReader',
                'rzModule',
                'switcher',
                'gfl.textAvatar',
                'textAngular',
                'ui.bootstrap.datetimepicker',
                'angular-confirm', 
                'toastr'
            ]
        ); 

        module.config(['toastrConfig', function (toastrConfig) {
            angular.extend(toastrConfig, {
                positionClass: 'toast-bottom-right',
                newestOnTop: true,
                allowHtml: false,
                closeButton: false,
                closeHtml: '<button>&times;</button>',
                extendedTimeOut: 1000,
                iconClasses: {
                    error: 'toast-error',
                    info: 'toast-info',
                    success: 'toast-success',
                    warning: 'toast-warning'
                },
                messageClass: 'toast-message',
                onHidden: null,
                onShown: null,
                onTap: null,
                progressBar: false,
                tapToDismiss: true,
                templates: {
                    toast: 'directives/toast/toast.html',
                    progressbar: 'directives/progressbar/progressbar.html'
                },
                timeOut: 5000,
                titleClass: 'toast-title',
                toastClass: 'toast'
            });
        }]);

    }
)();
//demographic-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, log) {
        var $ctrl = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        $ctrl.title = 'Demographic Updates';
        $ctrl.description = 'Updates made to constituent data';
        $ctrl.subTitle = 'Demographics';

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault
        };

        $ctrl.sources = [
            { id: null, name: '' },
            { id: 0, name: 'Tax' },
            { id: 1, name: 'RSVP' }
        ];

        $ctrl.$onInit = function () { console.log('event detail init'); }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;
            $ctrl.isBusy = true;
            console.log('search', $ctrl.searchModel);

            if (typeof (tableState.sort.predicate) !== "undefined") {
                $ctrl.searchModel.orderBy = tableState.sort.predicate;
                $ctrl.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            return $http.get('api/demographic', { params: $ctrl.searchModel })
                .then(function (r) {
                    $ctrl.demographics = r.data.results;
                    $ctrl.searchModel = r.data;
                    delete $ctrl.searchModel.results;
                }).catch(function (err) {
                    console.log('Oops', err.data.message);
                    toastr.error('Oops ' + err.data.message);
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
        }

        $ctrl.delete = function (d) {
            $ctrl.isBusy = true;
            console.log('d', d);
            $http.delete('api/demographic/' + d.id).then(function (r) {
                var idx = $ctrl.demographics.indexOf(d);
                $ctrl.demographics.splice(idx, 1);
                log.success('Record updated');
            }).catch(function (err) {
                console.log('Oops', err);
                console.log(err);
                log.error('Oops. Something went wrong. ' + err.data.message);
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.deleteAll = function () {
            $ctrl.isBusy = true;
            return $http.delete('api/demographic').then(function (r) {
                log.warning('Updated all records');
                $ctrl.searchModel(tableStateRef);
            }).catch(function (err) {
                console.log('Oops', err);
                log.error('Oops. Something went wrong. ' + err.data.message);
            }).finally(function () {
                $ctrl.isBusy = false;
            });

        }

        $ctrl.export = function () {
            $ctrl.isBusy = true;
            $http.get('api/demographic/export', { params: $ctrl.searchModel })
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        logger.log(ex);
                    }
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
        }


        $ctrl.paged = function paged() {
            $ctrl.search(tableStateRef);
        };

    }

    module.component('demographicList',
        {
            bindings: {
            },
            templateUrl: 'app/demographics/demographic-list.component.html',
            controller: ['$http', 'toastr', controller]
        });
}
)();
//mark.lawrence
//clear-key.directive.js

(function () {
    angular.module('app').directive("clearKey", function () {
        return {
            restrict: 'EA',
            require: 'ngModel',
            link: function (scope, el, attrs, ctrl) {
                el.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    ctrl.$setViewValue(null);
                    ctrl.$render();
                    scope.$apply();
                });
            }
        };
    });
})();
//mark.lawrence
//date-format.directive.js

(function () {
    angular.module('app')
        .directive('dateFormat',
            function (dateFilter, $parse) {
                return {
                    restrict: 'EAC',
                    require: '?ngModel',
                    link: function (scope, element, attrs, ngModel, ctrl) {
                        ngModel.$parsers.push(function (viewValue) {
                            return dateFilter(viewValue, 'MM/dd/yyyy h:mm a');
                        });
                    }
                }
            });
})();
//mark.lawrence
//date-higher-than.directive.js

(function () {

    angular.module('app').directive('dateHigherThan',
        function ($window) {
            return {
                require: '^ngModel',
                restrict: 'A',
                link: function (scope, elm, attrs, ctrl) {
                    var moment = $window.moment;
                    var t, f
                    var validate = function (viewValue) {
                        var comparisonModel = attrs.dateHigherThan;
                        comparisonModel = comparisonModel.replace(/["']/g, "") + 'Z';

                        if (!viewValue || !comparisonModel) {
                            ctrl.$setValidity('dateHigherThan', true);
                            return viewValue;
                        }

                        ctrl.$setValidity('dateHigherThan', moment(comparisonModel).isBefore(moment(viewValue)));
                        return viewValue;
                    };

                    ctrl.$parsers.unshift(validate);
                    ctrl.$formatters.push(validate);

                    attrs.$observe('dateHigherThan', function (comparisonModel) {
                        // Whenever the comparison model changes we'll re-validate
                        return validate(ctrl.$viewValue);
                    });

                }
            };
        }
    );

})();


//mark.lawrence
//date-input.directive.js

(function () {
    angular.module('app').directive('dateInput', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elm, attrs, ctrl) {
                var moment = $window.moment;
                var dateFormat = attrs.dateInput;

                attrs.$observe('dateInput', function (newValue) {
                    if (dateFormat === newValue || !ctrl.$modelValue) return;

                    dateFormat = newValue;
                    ctrl.$modelValue = moment(ctrl.$setViewValue).format(dateFormat);
                });

                ctrl.$formatters.unshift(function (modelValue) {
                    if (!dateFormat || !modelValue) return "";
                    var retVal = moment(modelValue).format(dateFormat);
                    return retVal;
                });

                ctrl.$parsers.unshift(function (viewValue) {
                    var date = moment(viewValue, dateFormat);
                    return (date && date.isValid() && date.year() > 1950) ? date.toDate() : "";
                });
            }
        };
    });
})();
//mark.lawrence
//date-lower-than.directive.js

(function () {

    angular.module('app').directive('dateLowerThan',
        function ($window) {
            return {
                require: '^ngModel',
                restrict: 'A',
                link: function (scope, elm, attrs, ctrl) {
                    var moment = $window.moment;
                    var t, f
                    var validate = function (viewValue) {
                        var comparisonModel = attrs.dateLowerThan;
                        comparisonModel = comparisonModel.replace(/["']/g, "") + 'Z';

                        if (!viewValue || !comparisonModel) {
                            ctrl.$setValidity('dateLowerThan', true);
                            return viewValue;
                        }

                        ctrl.$setValidity('dateLowerThan', moment(comparisonModel).isAfter(moment(viewValue)));
                        return viewValue;
                    };

                    ctrl.$parsers.unshift(validate);
                    ctrl.$formatters.push(validate);

                    attrs.$observe('dateLowerThan', function (comparisonModel) {
                        // Whenever the comparison model changes we'll re-validate
                        return validate(ctrl.$viewValue);
                    });

                }
            };
        }
    );

})();


//event-url.directive.js

var app = angular.module('app');

app.directive('urlAvailable', function ($q, $timeout, $http) {
    return {
        require: 'ngModel', 
        scope: {
            initialValue: '@'
        },
        link: function (scope, element, attrs, ctrl) {
            ctrl.$asyncValidators.unique = function (modelValue, viewValue) {
                var def = $q.defer();
                var value = modelValue || viewValue || '';
                var initialValue = scope.initialValue || '';

                if (!ctrl || !element.val() || !ctrl.$dirty) {
                    def.resolve();
                    return def.promise;
                }
          
                if (value.toLowerCase() !== initialValue.toLowerCase()) {
                    $http.get('api/event/eventnameurlavailable/' + modelValue).then(function (r) {
                        if (r.data) { def.resolve(); }
                        else { def.reject('Url exists'); }
                    });
                }
                else {
                    def.resolve();
                }
                return def.promise;
            };
        }
    };
});



//mark.lawrence
//smart-table.clearKey.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: ['^stTable', '^ngModel'],
            link: function (scope, element, attrs, ctrls) {
                element.on('keydown', function (event) {
                    var ngModel = ctrls[1];
                    var ctrl = ctrls[0];

                    if (event.which === 13) {
                        return ctrl.pipe();
                    }
                    if (event.which === 27) {

                        if (element.context.attributes['st-search'] !== undefined) {
                            return scope.$apply(function () {
                                var fieldName = element.context.attributes['st-search'].value;
                                var tableState = ctrl.tableState();
                                tableState.search.predicateObject[fieldName] = '';
                                return ctrl.pipe();
                            });

                        } else {
                            return scope.$apply(function () {
                                ngModel.$setViewValue(null);
                                ngModel.$render(); // will update the input value as well
                            });

                        }
                    }
                });
            }
        };
    });

    angular.module('app')
        .directive("stResetSearch",
            function () {
                return {
                    restrict: 'EA',
                    require: ['^stTable', '^ngModel'],
                    link: function (scope, element, attrs, ctrls) {
                        return element.bind('click',
                            function () {
                                var model = ctrls[1];
                                var ctrl = ctrls[0];

                                return scope.$apply(function () {
                                    angular.forEach(model.$viewValue,
                                        function (value, key) {
                                            if (key.toLowerCase() === 'page') {
                                                model.$viewValue[key] = 1;
                                            }
                                            if (Array.isArray(value) || _.includes(key.toLowerCase(), 'page')) return;
                                            model.$viewValue[key] = null;
                                        });
                                    var tableState = ctrl.tableState();
                                    tableState.search.predicateObject = {};
                                    tableState.pagination.start = 0;
                                    return ctrl.pipe();
                                });
                            });
                    }
                };
            });

    angular.module('app').directive('stSubmitSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
        return {
            require: '^stTable',
            link: function (scope, element, attr, ctrl) {
                return element.bind('click',
                    function () {
                        var tableCtrl = ctrl;
                        tableCtrl.pipe();
                    });

            }
        };
    }]);


    angular.module('smart-table')
      .directive('stSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
          return {
              require: '^stTable',
              link: function (scope, element, attr, ctrl) {
                  var tableCtrl = ctrl;
                  var promise = null;
                  var throttle = attr.stDelay || stConfig.search.delay;
                  var event = attr.stInputEvent || stConfig.search.inputEvent;

                  attr.$observe('stSearch', function (newValue, oldValue) {
                      var input = element[0].value;
                      if (newValue !== oldValue && input) {
                          ctrl.tableState().search = {};
                          tableCtrl.search(input, newValue);
                      }
                  });

                  //table state -> view
                  scope.$watch(function () {
                      return ctrl.tableState().search;
                  }, function (newValue, oldValue) {
                      var predicateExpression = attr.stSearch || '$';
                      if (newValue.predicateObject && $parse(predicateExpression)(newValue.predicateObject) !== element[0].value) {
                          element[0].value = $parse(predicateExpression)(newValue.predicateObject) || '';
                      }
                  }, true);

                  // view -> table state
                  element.bind(event, function (evt) {
                      evt = evt.originalEvent || evt;
                      if (promise !== null) {
                          $timeout.cancel(promise);
                      }

                      promise = $timeout(function () {
                          tableCtrl.search(evt.target.value, attr.stSearch || '');
                          promise = null;
                      }, throttle);
                  });
              }
          };
      }]);

})();
(function() {


    var app = angular.module('app');

    app.directive('toggleCheckbox', function($timeout) {

        /**
     * Directive
     */
        return {
            restrict: 'A',
            transclude: true,
            replace: false,
            require: 'ngModel',
            link: function($scope, $element, $attr, ngModel) {

                // update model from Element
                var updateModelFromElement = function() {
                    // If modified
                    var checked = $element.prop('checked');
                    if (checked !== ngModel.$viewValue) {
                        // Update ngModel
                        ngModel.$setViewValue(checked);
                        $scope.$apply();
                    }
                };

                // Update input from Model
                var updateElementFromModel = function(newValue) {
                    $element.trigger('change');
                };

                // Observe: Element changes affect Model
                $element.on('change', function() {
                    updateModelFromElement();
                });

                $scope.$watch(function() {
                    return ngModel.$viewValue;
                }, function(newValue) {
                    updateElementFromModel(newValue);
                }, true);

                // Initialise BootstrapToggle
                $element.bootstrapToggle();
            }
        };
    });
})();
//constituent-edit.component.js
(function () {
    var module = angular.module('app');

    function controller($http) {
        var $ctrl = this;

        $ctrl.$onInit = function () {
            console.log('constituent edit init');
            if ($ctrl.resolve) {
                $ctrl.person = angular.copy($ctrl.resolve.person);
            }

            $ctrl.title = $ctrl.person.name;
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            console.log('save', $ctrl.person);
            $http.put('api/constituent', $ctrl.person).then(function(r) {
                $ctrl.modalInstance.close($ctrl.person);
            });
        }
    }

    module.component('constituentEdit',
        {
            bindings: {
                person: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            templateUrl: 'app/donortax/constituent-edit.component.html',
            controller: ['$http', controller]
        });

}
)();
//tax-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, toastr, $modal) {
        var $ctrl = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        $ctrl.title = 'Donor Tax Manager';
        $ctrl.subTitle = 'Constituents';

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };

        $ctrl.$onInit = function () {
            console.log('tax list init');
        }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                $ctrl.searchModel.orderBy = tableState.sort.predicate;
                $ctrl.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            $ctrl.isBusy = true;
            console.log('model', $ctrl.searchModel);
            $http.get('api/constituent', { params: $ctrl.searchModel })
                .then(function (r) {
                    $ctrl.people = r.data.results;
                    $ctrl.searchModel = r.data;
                    delete $ctrl.searchModel.results;
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
        }

        $ctrl.paged = function paged(pageNum) {
            $ctrl.search(tableStateRef);
        };

        $ctrl.edit = function (person) {
            $modal.open({
                component: 'constituentEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    person: person
                },
                size: 'lg'
            }).result.then(function (result) {
                angular.extend(person, result);
                toastr.info('Saved ' + result.name);
            }, function (reason) {
            });
        }

        $ctrl.viewTaxes = function (person) {
            console.log('view tax', person);
            $modal.open({
                component: 'taxDetail',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    person: person
                },
                size: 'md'
            }).result.then(function (result) {
                angular.extend(item, result);
                toastr.info('Saved ' + result.title);
            }, function (reason) {
            });
        }
    }

    module.component('constituentList',
        {
            templateUrl: 'app/donortax/constituent-list.component.html',
            controller: ['$http', 'toastr', '$uibModal', controller]
        });
}
)();
//tax-detail.component.js
(function () {
    var module = angular.module('app');

    function getYears(currentYear) {
        var years = [];
        //var currentYear = parseInt(moment().get('Year'));

        for (var i = 0; i < 5; i++) {
            years.push(currentYear - i);
        }
        return years;
    }

    function controller($http, toastr) {
        var $ctrl = this;
        var currentYear = parseInt(moment().get('Year'));

        $ctrl.$onInit = function () {
            console.log('tax detail init');
            $ctrl.isBusy = true;
            $ctrl.newItem = {};

            if ($ctrl.resolve) {
                $ctrl.person = $ctrl.resolve.person;
            }

            $ctrl.title = $ctrl.person.firstName + ' ' + $ctrl.person.lastName;
            $ctrl.selectedYear = currentYear - 1;
            $ctrl.years = getYears(currentYear);
            $ctrl.yearChange();

            $http.get('api/tax/' + $ctrl.person.lookupId).then(function (r) {
                $ctrl.taxItems = r.data;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.addItem = function() {
            $ctrl.isBusy = true;

            $ctrl.newItem.constituentId = $ctrl.person.id;
            $ctrl.newItem.taxYear = moment($ctrl.newItem.donationDate).year();

            $http.post('api/tax', $ctrl.newItem ).then(function(r) {
                $ctrl.taxItems.push(r.data);
                toastr.success('Saved tax entry');
            }).catch(function(err) {
                toastr.error('Oops. Error creating tax entry');
            }).finally(function() {
                $ctrl.isBusy = false; 
            });
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.cancelEdit = function () {
            $ctrl.currentEdit = {};
        }

        $ctrl.delete = function(item) {
            $ctrl.isBusy = true;

            $http.delete('api/tax/' + item.id).then(function(r) {
                toastr.warning('Delete tax item ' + item.amount);
                var idx = $ctrl.taxItems.indexOf(item);
                $ctrl.taxItems.splice(idx, 1);
            }).catch(function(err) {
                toastr.error('Oops. Error deleting tax');
            }).finally(function() {
                $ctrl.isBusy = false;
            }); 
        }

        $ctrl.edit = function (item) {
            console.log('item', item);
            $ctrl.currentEdit = {};
            $ctrl.currentEdit[item.id] = true;
            $ctrl.itemToEdit = angular.copy(item);
            $ctrl.itemToEdit.donationDate = moment($ctrl.itemToEdit.donationDate).toDate();
        }

        $ctrl.save = function (item) {
            $ctrl.isBusy = true;
            $http.put('api/tax', $ctrl.itemToEdit)
                .then(function (r) {
                    angular.extend(item, r.data);
                    $ctrl.currentEdit = {};
                    toastr.success('Updated tax item ' + moment(item.donationDate).format('MM/dd/yyyy'));
                }).catch(function(err) {
                    toastr.error('Error saving tax entry');
                }).finally(function() {
                    $ctrl.isBusy = false; 
                });
        }

        $ctrl.yearChange = function () {
            $ctrl.dateOptions = {
                maxDate: new Date('12/30/' + $ctrl.selectedYear),
                minDate: new Date('1/1/' + $ctrl.selectedYear)
            };
            $ctrl.newItem.donationDate = $ctrl.dateOptions.minDate;
        }

    }

    module.component('taxDetail',
        {
            bindings: {
                person: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            templateUrl: 'app/donortax/tax-details.component.html',
            controller: ['$http', 'toastr', controller]
        });

}
)();
//mark.lawrence
//env.js

(function (window) {
    window.__env = window.__env || {};

    switch (window.location.hostname) {
        case 'donorgatewaystage.azurewebsites.net':
            window.__env.rsvpUrl = 'eventrsvpstage.azurewebsites.net';
            break;
        case 'donorgatewaystage.splcenter.org':
            window.__env.rsvpUrl = 'rsvpstage.splcenter.org';
            break;
        case 'donorgateway.splcenter.org':
            window.__env.rsvpUrl = 'rsvp.splcenter.org';
            break;
        case 'donorgateway.azurewebsites.net':
            window.__env.rsvpUrl = 'eventrsvp.azurewebsites.net';
            break;
        default:
            window.__env.rsvpUrl = 'localhost:53172';
    }

    // API url
    window.__env.apiUrl = 'http://' + window.location.host + '/api';

    // Base url
    window.__env.baseUrl = '/';

    // Whether or not to enable debug mode
    // Setting this to false will disable console output
    window.__env.enableDebug = true;
}(this));
//event-create.component.js
(function () {
    var module = angular.module('app');

    function eventCreateController($http, log) {
        var ctrl = this;

        ctrl.title = 'Create Event';
        ctrl.dateFormat = "MM/DD/YYYY h:mm A";

        ctrl.$onInit = function () {
            ctrl.event = {
                startDate: moment(new Date()).add(1, 'hour').startOf('hour'),
                endDate: moment(new Date()).add(5, 'days').startOf('hour'),
                capacity: 1,
                template: {}
            };
        }

        ctrl.cancel = function () {
            ctrl.dismiss();
        }

        ctrl.save = function () {
            $http.post('api/event', ctrl.event).then(function (r) {
                angular.extend(ctrl.event, r.data);
                ctrl.modalInstance.close(ctrl.event);
            }).catch(function (err) {
                console.log('Oops. Something went wrong saving event', err);
                log.error('Oops. Something went wrong saving event');
            });
        }

        function convertDate(date) {
            if (date) return moment(date).format('YYYY-MM-DDTHH:mm');
        }

    }

    module.component('eventCreate',
        {
            bindings: {
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            templateUrl: 'app/events/event-create.component.html',
            controller: ['$http', 'toastr', eventCreateController]
        });

}
)();
//event-dashboard.component.js
(function () {
    var module = angular.module('app');

    function eventDashboardController($http, $modal, toastr) {
        var ctrl = this;

        ctrl.title = 'Event Manager';
        ctrl.description = "Manage Donor Events";

        ctrl.$onInit = function () {
            console.log('event dashboard init');
            ctrl.isBusy = true; 
            $http.get('api/event').then(function (r) {
                ctrl.events = r.data;
            }).catch(function (err) {
                console.log("Oops. Can't get list of events", err);
                toastr.error("Oops. Can't get list of events");
            }).finally(function () {
                ctrl.isBusy = false;
            });
        }

        ctrl.create = function() {
            $modal.open({
                component: 'eventCreate',
                bindings: {
                    modalInstance: "<"
                },
                size: 'md'
            }).result.then(function (result) {
                ctrl.selectedEvent = result;
                ctrl.events.unshift(ctrl.selectedEvent);
                console.log('selected event', ctrl.selectedEvent);
                toastr.info('Created Event ' + result.name);
            }, function (reason) {
            });            
        }

        ctrl.changeEvent = function() {
            ctrl.selectedEventId = ctrl.selectedEvent.id; 
        }

        ctrl.eventDeleted = function() {
            var idx = ctrl.events.indexOf(ctrl.selectedEvent);
            ctrl.events.splice(idx, 1);
            ctrl.selectedEvent = null; 
        }

        ctrl.eventUpdated = function (event) {
            ctrl.isBusy = true; 
            angular.extend(ctrl.selectedEvent, event);
            ctrl.isBusy = false; 
        }
    }

    module.component('eventDashboard',
        {
            bindings: {
            },
            templateUrl: 'app/events/event-dashboard.component.html',
            controller: ['$http', '$uibModal', 'toastr', eventDashboardController]
        });
}
)();
//event-detail.component.js
(function () {
    var module = angular.module('app');

    function parseErrors(response) {
        var errors = [];
        var key;
        for (key in response.modelState) {
            if (response.modelState.hasOwnProperty(key)) {
                for (var i = 0; i < response.modelState[key].length; i++) {
                    if (key === '$id') break;
                    errors.push(response.modelState[key][i]);
                }
            }
        }
        return errors;
    }

    function eventDetailController($http, log, $scope) {
        var ctrl = this;

        ctrl.dateFormat = "MM/DD/YYYY h:mm A";
        ctrl.hostLocation = window.__env.rsvpUrl + '/';

        ctrl.$onChanges = function () {
            ctrl.refreshEvent();
        }

        ctrl.$onInit = function () { console.log('event detail init'); }

        ctrl.refreshEvent = function () {
            if (ctrl.eventId === undefined) return;
            ctrl.isBusy = true;
            $http.get('api/event/' + ctrl.eventId).then(function (r) {
                ctrl.event = r.data;
                ctrl.nameUrl = r.data.nameUrl;
            }).catch(function (err) {
                console.log('Opps. Something went wrong', err);
            }).finally(function () {
                ctrl.isBusy = false;
            });
        }

        ctrl.delete = function () {
            $http.delete('api/event/' + ctrl.eventId).then(function (r) {
                ctrl.event = null;
                log.warning('Deleted event');
                ctrl.onDelete();
            }).catch(function (err) {
                console.log('Oops. Something went wrong deleting event', err);
                log.error('Oops. Something went wrong deleting event');
            });

        }

        ctrl.saveEvent = function () {
            ctrl.isBusy = true;
            return $http.put('api/event', ctrl.event)
                .then(function (r) {
                    angular.extend(ctrl.event, r.data);
                    log.success('Updated ' + ctrl.event.initiative);
                    ctrl.onUpdated({ event: ctrl.event });
                }).catch(function (err) {
                    console.log('Oops. Something went wrong saving event');
                    log.error('Oops. Something went wrong saving event');
                    ctrl.errors = parseErrors(err.data);
                }).finally(function () {
                    ctrl.isBusy = false;
                });
        }

        ctrl.toggleCancel = function () {
            ctrl.event.isCancelled = !ctrl.event.isCancelled;
            ctrl.saveEvent();
        }

        function convertDate(date) {
            if (date) return moment(date).format('YYYY-MM-DDTHH:mm');
        }
    }

    module.component('eventDetail',
        {
            bindings: {
                onDelete: '&',
                eventId: '<',
                onUpdated: '&'
            },
            templateUrl: 'app/events/event-detail.component.html',
            controller: ['$http', 'toastr', '$scope', eventDetailController]
        });
}
)();
//event-template.component.js
(function () {
    var module = angular.module('app');

    function eventTemplateController($scope, $http, log) {
        var ctrl = this;

        ctrl.title = 'Event Template';
        ctrl.description = "Update Event Template";

        ctrl.$onChanges = function () {
            ctrl.refresh();
        }

        ctrl.$onInit = function () {
            console.log('event template init');
        }

        ctrl.refresh = function () {
            console.log('template refresh');
            if (ctrl.templateId === undefined) return;
            ctrl.isBusy = true;
            $http.get('api/template/' + ctrl.templateId).then(function (r) {
                ctrl.template = r.data;
                ctrl.templateDelta = angular.copy(ctrl.template); 
            }).catch(function (err) {
                console.log("Oops. Can't get event template", err);
                log.error("Oops. Can't get event template");
            }).finally(function () {
                ctrl.isBusy = false;
            });
        }

        ctrl.cancel = function() {
            ctrl.template = angular.copy(ctrl.templateDelta); 
        }

        ctrl.save = function () {
            ctrl.isBusy = true; 
            $http.put('api/template', ctrl.template).then(function (r) {
                angular.extend(ctrl.template, r.data);
                ctrl.templateDelta = angular.copy(ctrl.template);
                log.success('Updated template');
            }).catch(function (err) {
                console.log('Oops. Error updating template', err);
                log.error('Oops. Something went wrong updating template: ' + err.data.message);
            }).finally(function() {
                ctrl.isBusy = false; 
            });
        }

        ctrl.fileSelected = function ($files, $file) {

            ctrl.isBusy = true;
            var file = $file;

            var src = '';
            var reader = new FileReader();

            reader.onloadstart = function () { }

            reader.onload = function (e) {
                src = reader.result;
                ctrl.template.image = reader.result;
                ctrl.template.mimeType = file.type;
                ctrl.isBusy = false;
            }

            reader.onerror = function (e) {
                console.log('reader error', e);
                log.error('Oops. Error reading image'); 
            }

            reader.onloadend = function (e) {
                //Added due to large images not complete before digest cycle. 
                $scope.$apply();
            };

            reader.readAsDataURL(file);
        };
    }

    module.component('eventTemplate',
        {
            bindings: {
                templateId: '<'
            },
            templateUrl: 'app/events/event-template.component.html',
            controller: ['$scope', '$http', 'toastr', eventTemplateController]
        });
}
)();
//guest-edit.component.js
(function () {
    var module = angular.module('app');

    function guestEditController($http, log) {
        var ctrl = this;
        ctrl.ticketCountList = [];

        ctrl.$onInit = function () {
            console.log('guest edit init');

            if (ctrl.resolve) {
                ctrl.id = ctrl.resolve.guestId;
                ctrl.eventId = ctrl.resolve.eventId;
            }

            getGuestDetails().then(function (r) {
                ctrl.guest = r;
            }).then(function () {
                ctrl.title = ctrl.guest.name || 'New Guest'; 
                for (var i = 1; i < (ctrl.guest.ticketAllowance || 5) + 1; i++) {
                    ctrl.ticketCountList.push(i);
                }
            });
        }

        function getGuestDetails() {
            if (ctrl.id) {
                return $http.get('api/event/guest/' + ctrl.id).then(function (r) {
                    return r.data;
                }).catch(function (err) {
                    console.log('err', err.message);
                    log.error('Oops. Something went wrong getting guest information');
                });
            } else {
                return $http.get('api/event/' + ctrl.eventId).then(function (r) {
                    return { eventId: ctrl.eventId, ticketAllowance: r.data.ticketAllowance }
                }).catch(function (err) {
                    console.log('Opps. Something went wrong getting event', err);
                });
            }
        }

        ctrl.changeAttending = function () {
            if (ctrl.guest.isAttending) {
                ctrl.guest.ticketCount = 1;
            } else {
                ctrl.guest.ticketCount = null;
            }
        }

        ctrl.changeTicket = function () {
            ctrl.guest.isAttending = ctrl.guest.ticketCount !== null;
        }

        ctrl.cancel = function () {
            ctrl.dismiss();
        }

        ctrl.save = function () {
            $http.post('api/event/' + ctrl.guest.eventId + '/register/', ctrl.guest).then(function (r) {
                angular.extend(ctrl.guest, r.data);
                ctrl.modalInstance.close(ctrl.guest);
            }).catch(function (err) {
                console.log('Oops. Something went wrong', err);
                log.error('Oops. Something went wrong registering guest', err.data.message);
            });
        }
    }

    module.component('guestEdit',
        {
            bindings: {
                guestId: '<',
                eventId: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            templateUrl: 'app/events/guest-edit.component.html',
            controller: ['$http', 'toastr', guestEditController]
        });

}
)();
//guest-import.component.js
(function () {
    var module = angular.module('app');

    function formDataObject(data) {
        var fd = new FormData();
        fd.append('file', data);
        return fd;
    }

    function guestImportController($http, log) {
        var ctrl = this;

        ctrl.title = 'Upload Guest List';

        ctrl.$onInit = function () {
            console.log('guest import init');
            if (ctrl.resolve) {
                ctrl.eventId = ctrl.resolve.eventId;
            }
        }

        ctrl.fileSelected = function ($file, $event) {
            ctrl.result = null;
        };

        ctrl.cancel = function () {
            $modal.dismiss();
        }

        ctrl.save = function () {
            ctrl.isBusy = true; 
            $http.post('api/file/guest/' + ctrl.eventId, formDataObject(ctrl.file), {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(function (r) {
                log.success(r.data.messages[0] + ' in ' + r.data.totalTime);
                console.log('response', r.data);
                ctrl.isBusy = false; 
                ctrl.modalInstance.close();
            }).catch(function(err) {
                console.log('Oops. Something when wrong', err);
            });
        }

    }

    module.component('guestImport',
        {
            bindings: {
                eventId: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            templateUrl: 'app/events/guest-import.component.html',
            controller: ['$http', 'toastr', guestImportController]
        });

}
)();
//guest-list.component.js
(function () {
    var module = angular.module('app');

    function guestListController($http, $modal, toastr) {
        var ctrl = this;
        var tableStateRef;
        var pageSizeDefault = 10;
        var choices =
            [
            { id: 1, name: "Register", command: function (e) { ctrl.registerGuest(e) }, icon: 'icon ion-key', default: true },
            { id: 2, name: "Mail Ticket", command: function (e) { ctrl.sendMail(e) }, icon: 'icon ion-android-mail', default: false },
            { id: 3, name: "Cancel", command: function (e) { ctrl.cancelRegistration(e) }, icon: 'icon ion-android-cancel', default: false },
            { id: 4, name: "Guest List", command: function (e) { ctrl.reservationOverride(e) }, icon: 'icon ion-android-add-circle', default: false },
            { id: 5, name: "Add Tickets", command: function (e) { ctrl.registerGuest(e) }, icon: 'icon ion-android-add-circle', default: false }
        ];
        
        ctrl.title = 'Reservation Manager';
        ctrl.description = "Manage Guest List";

        ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };

        ctrl.$onChanges = function () {
            ctrl.search();
        }

        ctrl.$onInit = function () {
            console.log('guest list init');
        }

        ctrl.resetSearch = function () {
            ctrl.searchModel = {
                page: 1,
                pageSize: pageSizeDefault,
                orderBy: 'id',
                orderDirection: 'asc'
            };
            ctrl.quickFilter = null;
            ctrl.search(tableStateRef);
        }

        ctrl.search = function () {
            ctrl.isBusy = true;
            if (ctrl.eventId === undefined) return;
            $http.get('api/event/' + ctrl.eventId + '/guests', { params: ctrl.searchModel }).then(function (r) {
                ctrl.searchModel = r.data;
                ctrl.guests = [];
                r.data.results.map(function (guest) {
                    guest.choices = buildGuestOptions(guest);
                    ctrl.guests.push(guest);
                });
                delete ctrl.searchModel.results;
            }).catch(function (err) {
                console.log('Oops. Something went wrong', err);
            }).finally(function () {
                ctrl.isBusy = false;
            });
        }

        ctrl.paged = function paged() {
            ctrl.search(tableStateRef);
        };

        ctrl.quickFilterChange = function () {
            ctrl.searchModel.page = 1;
            ctrl.searchModel.isWaiting = null;
            ctrl.searchModel.isMailed = null;
            ctrl.searchModel.isAttending = null;

            ctrl.showSendMail = null; 
            ctrl.showSendWaiting = null; 

            switch (ctrl.quickFilter) {
                case 'WaitingAndNotSent':
                    ctrl.searchModel.isWaiting = true;
                    ctrl.searchModel.isMailed = false;
                    ctrl.showSendWaiting = true; 
                    break;
                case 'WaitingAndSent':
                    ctrl.searchModel.isWaiting = true;
                    ctrl.searchModel.isMailed = true;;
                    break;
                case 'TicketNotSent':
                    ctrl.searchModel.isAttending = true;
                    ctrl.searchModel.isMailed = false;
                    ctrl.searchModel.isWaiting = false;
                    ctrl.showSendMail = true; 
                    break;
                case 'TicketSent':
                    ctrl.searchModel.isAttending = true;
                    ctrl.searchModel.isMailed = true;
                    ctrl.searchModel.isWaiting = false;
                    break;
                default:
            }
            ctrl.search(tableStateRef);
        }

        ctrl.reservationOverride = function (e) {
            $http.post('api/event/' + ctrl.eventId + '/register/', e).then(function (r) {
                var guest = r.data;
                guest.choices = buildGuestOptions(guest);
                angular.extend(e, guest);
                toastr.success('Registered ' + guest.name);
            }).catch(function (err) {
                console.log('Oops. Something went wrong', err);
                toastr.error('Oops. Something went wrong registering guest', err.data.message);
            });
        }

        ctrl.cancelRegistration = function (e) {
            $http.post('api/event/' + ctrl.eventId + '/cancelregister/' + e.id).then(function (r) {
                var guest = r.data;
                guest.choices = buildGuestOptions(guest);
                angular.extend(e, guest);
                toastr.success('Canceled registration for ' + guest.name);
            }).catch(function (err) {
                console.log('Oops. Something went wrong', err);
                toastr.error('Oops. Something went wrong cancelling registration', err.data.message);
            });
        }

        ctrl.registerGuest = function (e) {
            var newGuest = false;
            if (!e) {
                e = { id: null, eventId: ctrl.eventId }
                newGuest = true;
            }

            $modal.open({
                component: 'guestEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    guestId: e.id,
                    eventId: e.eventId
                },
                size: 'md'
            }).result.then(function (result) {
                result.choices = buildGuestOptions(result);
                angular.extend(e, result);
                if (newGuest) ctrl.guests.unshift(e);
                toastr.info('Registered ' + result.name);
            }, function (reason) {
            });
        }

        ctrl.sendMail = function (e) {
            $http.post('api/event/' + ctrl.eventId + '/mailticket/' + e.id).then(function (r) {
                var guest = r.data;
                guest.choices = buildGuestOptions(guest);
                angular.extend(e, guest);
                toastr.success('Mailed ticket for ' + guest.name);
            }).catch(function (err) {
                console.log('Oops. Something went wrong', err);
                toastr.error('Oops. Something went wrong mailing ticket', err.data.message);
            });
        }

        ctrl.sendAllMail = function() {
            $http.post('api/event/' + ctrl.eventId + '/sendalltickets').then(function (r) {
                toastr.success('Mailed all tickets');
            }).catch(function (err) {
                console.log('Oops. Something went wrong', err);
                toastr.error('Oops. Something went wrong mailing tickets', err.data.message);
            });
        }

        ctrl.sendAllWaiting = function () {
            $http.post('api/event/' + ctrl.eventId + '/sendallwaiting').then(function (r) {
                toastr.success('Mailed all letters');
            }).catch(function (err) {
                console.log('Oops. Something went wrong', err);
                toastr.error('Oops. Something went wrong mailing letters', err.data.message);
            });
        }

        ctrl.export = function() {
            ctrl.isBusy = true;
            $http.get('api/event/' + ctrl.eventId + '/guests/export', { params: ctrl.searchModel })
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        logger.log(ex);
                    }
                }).finally(function () {
                    ctrl.isBusy = false;
                });
        }

        ctrl.import = function() {
            $modal.open({
                component: 'guestImport',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    eventId: ctrl.eventId
                },
                size: 'md'
            }).result.then(function (result) {
                ctrl.search(tableStateRef);
            }, function (reason) {
            });
        }

        function buildGuestOptions(guest) {
            var options = [];

            if (guest.canRegister) options.push(choices[0]);
            if (guest.canMail) options.push(choices[1]);
            if (guest.canAddToAttending) options.push(choices[3]);

            if (guest.canAddTickets) options.push(choices[4]);
            if (guest.canCancel) options.push(choices[2]);

            guest.primaryChoice = angular.copy(options[0]);
            options.shift();
            return options;
        }

    }

    module.component('guestList',
        {
            bindings: {
                eventId: '<'
            },
            templateUrl: 'app/events/guest-list.component.html',
            controller: ['$http', '$uibModal', 'toastr', guestListController]
        });

}
)();
//mailer-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, toastr, $modal) {
        var $ctrl = this;
        var tableStateRef;
        var pageSizeDefault = 10;

        $ctrl.title = 'MarkIt Manager';
        $ctrl.subTitle = 'Mailers';

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            //orderBy: 'campaignId',
            //orderDirection: 'desc',
            suppress: false
        };

        $ctrl.$onInit = function () {
            console.log('mail list init');
            $http.get('api/mailer/campaigns').then(function (r) {
                $ctrl.campaigns = r.data;
            });
            $http.get('api/mailer/reasons').then(function (r) {
                $ctrl.reasons = r.data;
            });
        }

        $ctrl.download = function () {
            $ctrl.isBusy = true;
            $http.post('api/mailer/export', $ctrl.searchModel)
                .then(function (data) {
                    var contentType = data.headers()['content-type'];
                    var filename = data.headers()['x-filename'];

                    var linkElement = document.createElement('a');
                    try {
                        var blob = new Blob([data.data], { type: contentType });
                        var url = window.URL.createObjectURL(blob);

                        linkElement.setAttribute('href', url);
                        linkElement.setAttribute("download", filename);

                        var clickEvent = new MouseEvent("click", {
                            "view": window,
                            "bubbles": true,
                            "cancelable": false
                        });
                        linkElement.dispatchEvent(clickEvent);
                    } catch (ex) {
                        console.log(ex);
                        toastr.error('Oops ' + ex.data.message);
                    }
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
        }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;
            $ctrl.isBusy = true;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                $ctrl.searchModel.orderBy = tableState.sort.predicate;
                $ctrl.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            if ($ctrl.searchModel.suppress === null) $ctrl.searchModel.suppress = false;
            return $http.get('api/mailer', { params: $ctrl.searchModel })
                .then(function (r) {
                    $ctrl.mailers = r.data.results;
                    $ctrl.searchModel = r.data;
                    delete $ctrl.searchModel.results;
                }).catch(function (err) {
                    console.log('Oops', err.data.message);
                    toastr.error('Oops ' + err.data.message);
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
        }

        $ctrl.showUpload = function () {
            $modal.open({
                component: 'mailerUpload',
                bindings: {
                    modalInstance: "<"
                },
                size: 'md'
            }).result.then(function (result) {
                toastr.info('Uploaded ' + result.title);
            }, function (reason) {
            });
        }

        $ctrl.paged = function paged() {
            $ctrl.search(tableStateRef);
        };

        $ctrl.toggleFilter = function () {
            $ctrl.showSuppress = !$ctrl.showSuppress;
            $ctrl.searchModel.suppress = $ctrl.showSuppress;
            $ctrl.search(tableStateRef);
        }

        $ctrl.toggleSuppress = function (mailer) {
            $ctrl.isBusy = true; 
            if (mailer.suppress) {
                mailer.suppress = false;
                mailer.reasonId = null;
                $ctrl.isBusy = true;
                return $http.put('api/mailer', mailer).then(function (r) {
                    angular.extend(mailer, r.data);
                }).catch(function (err) {
                    console.log('Error saving mailer', err.message);
                    $toastr.error('Oops ' + err.data.message);
                }).finally(function () {
                    $ctrl.isBusy = false;
                });
            } else {
                $modal.open({
                    component: 'mailerSuppress',
                    bindings: {
                        modalInstance: "<"
                    },
                    resolve: {
                        mailer: mailer
                    },
                    size: 'md'
                }).result.then(function (result) {
                    angular.extend(mailer, result);
                    toastr.info('Saved ' + result.firstName + ' ' + result.lastName);
                }, function (reason) {
                });
            }
            $ctrl.isBusy = false; 
        }
    }

    module.component('mailerList',
        {
            templateUrl: 'app/mailers/mailer-list.component.html',
            controller: ['$http', 'toastr', '$uibModal', controller]
        });
}
)();
//mailer-suppress.component.js
(function () {
    var module = angular.module('app');

    function controller($http) {
        var $ctrl = this;

        $ctrl.$onInit = function () {
            console.log('mailer suppress init');
            if ($ctrl.resolve) {
                $ctrl.mailer = $ctrl.resolve.mailer;
                $ctrl.title = $ctrl.mailer.firstName + ' ' + $ctrl.mailer.lastName;
            }

            $http.get('api/mailer/reasons').then(function (r) {
                $ctrl.reasons = r.data;
            });
        }

        $ctrl.cancel = function() {
            $ctrl.dismiss();    
        }

        $ctrl.save = function () {
            $ctrl.mailer.suppress = true; 
            return $http.put('api/mailer', $ctrl.mailer).then(function (r) {
                angular.extend($ctrl.mailer, r.data);
                $ctrl.modalInstance.close($ctrl.mailer);
            }).catch(function (err) {
                console.log('Error saving mailer', err.message);
            }).finally(function () {
            });
        }
    };

    module.component('mailerSuppress',
        {
            templateUrl: 'app/mailers/mailer-suppress.component.html',
            bindings: {
                id: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            controller: ['$http', controller]
        });
}
)();
//mailer-upload.component.js
(function () {
    var module = angular.module('app');

    function formDataObject(data) {
        var fd = new FormData();
        fd.append('file', data);
        return fd;
    }

    function controller($http, toastr) {
        var $ctrl = this;
        $ctrl.title = 'Mailer Upload';

        $ctrl.$onInit = function () {
            console.log('Mailer Upload Init');
            $http.get('api/mailer/campaigns').then(function (r) {
                $ctrl.campaigns = r.data;
            });
        }

        $ctrl.cancel = function () {
            $ctrl.file = undefined;
            $ctrl.dismiss();
        }

        $ctrl.fileSelected = function ($file, $event) {
            $ctrl.result = null;
        };

        $ctrl.saveCampaign = function () {
            $http.post('api/mailer/createcampaign', $ctrl.campaign).then(function (r) {
                $ctrl.campaigns.unshift(r.data);
                $ctrl.selectedCampaign = r.data;
                $ctrl.showCreate = false;
            }).catch(function (err) {
                toastr.error('Oops ' + err.data.message);
            });
        }

        $ctrl.upload = function () {
            $ctrl.isBusy = true;
            $ctrl.result = {
                success: false
            }
            var id = $ctrl.selectedCampaign.id; 

            return $http.post('api/file/mailer/' + id, formDataObject($ctrl.file), {
                transformRequest: angular.identity,
                headers: { 'Content-Type': undefined }
            }).then(function (r) {
                $ctrl.result.success = true;
                $ctrl.result.message = r.data.message[0];
            }).catch(function (error) {
                $ctrl.result.message = error.data.message;
            }).finally(function () {
                $ctrl.file = undefined;
                $ctrl.isBusy = false;
                $ctrl.result.campaigns = $ctrl.campaigns;
                $ctrl.modalInstance.close($ctrl.result);
            });

            //service.mailer(vm.selectedCampaign.id, vm.file)
            //    .then(function (data) {
            //        $ctrl.result.success = true;
            //        $ctrl.result.message = data;
            //    })
            //    .catch(function (error) {
            //        $ctrl.result.message = error.data.message;
            //    })
            //    .finally(function () {
            //        $ctrl.file = undefined;
            //        $ctrl.isBusy = false;
            //        $ctrl.result.campaigns = $ctrl.campaigns;
            //        $ctrl.modalInstance.close($ctrl.result);
            //    });
        }
    }

    module.component('mailerUpload',
        {
            bindings: {
                id: '<',
                resolve: '<',
                close: '&',
                dismiss: '&',
                modalInstance: '<'
            },
            templateUrl: 'app/mailers/mailer-upload.component.html',
            controller: ['$http', 'toastr', controller]
        });

}
)();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJkZW1vZ3JhcGhpY3MvZGVtb2dyYXBoaWMtbGlzdC5jb21wb25lbnQuanMiLCJkaXJlY3RpdmVzL2NsZWFyLWtleS5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL2RhdGUtZm9ybWF0LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvZGF0ZS1oaWdoZXItdGhhbi5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL2RhdGUtaW5wdXQuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9kYXRlLWxvd2VyLXRoYW4uZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9ldmVudC11cmwuZGlyZWN0aXZlLmpzIiwiZGlyZWN0aXZlcy9zbWFydC10YWJsZS5kaXJlY3RpdmUuanMiLCJkaXJlY3RpdmVzL3RvZ2dsZUNoZWNrYm94LmRpcmVjdGl2ZS5qcyIsImRvbm9ydGF4L2NvbnN0aXR1ZW50LWVkaXQuY29tcG9uZW50LmpzIiwiZG9ub3J0YXgvY29uc3RpdHVlbnQtbGlzdC5jb21wb25lbnQuanMiLCJkb25vcnRheC90YXgtZGV0YWlsLmNvbXBvbmVudC5qcyIsImVudi5qcyIsImV2ZW50cy9ldmVudC1jcmVhdGUuY29tcG9uZW50LmpzIiwiZXZlbnRzL2V2ZW50LWRhc2hib2FyZC5jb21wb25lbnQuanMiLCJldmVudHMvZXZlbnQtZGV0YWlsLmNvbXBvbmVudC5qcyIsImV2ZW50cy9ldmVudC10ZW1wbGF0ZS5jb21wb25lbnQuanMiLCJldmVudHMvZ3Vlc3QtZWRpdC5jb21wb25lbnQuanMiLCJldmVudHMvZ3Vlc3QtaW1wb3J0LmNvbXBvbmVudC5qcyIsImV2ZW50cy9ndWVzdC1saXN0LmNvbXBvbmVudC5qcyIsIm1haWxlcnMvbWFpbGVyLWxpc3QuY29tcG9uZW50LmpzIiwibWFpbGVycy9tYWlsZXItc3VwcHJlc3MuY29tcG9uZW50LmpzIiwibWFpbGVycy9tYWlsZXItdXBsb2FkLmNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9hcHAubW9kdWxlLmpzXHJcbihmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsXHJcbiAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgIC8vYW5ndWxhciBtb2R1bGVzXHJcbiAgICAgICAgICAgICAgICAnbmdNZXNzYWdlcycsXHJcbiAgICAgICAgICAgICAgICAnYW5ndWxhckxvY2FsU3RvcmFnZScsXHJcbiAgICAgICAgICAgICAgICAnbmdSb3V0ZScsXHJcbiAgICAgICAgICAgICAgICAnbmdBbmltYXRlJyxcclxuXHJcbiAgICAgICAgICAgICAgICAvL3RoaXJkIHBhcnR5IG1vZHVsZXNcclxuICAgICAgICAgICAgICAgICdhbmd1bGFyLWR1cmF0aW9uLWZvcm1hdCcsIFxyXG4gICAgICAgICAgICAgICAgJ3NtYXJ0LXRhYmxlJyxcclxuICAgICAgICAgICAgICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgICAgICAgICAgICAgJ25nVGFnc0lucHV0JyxcclxuICAgICAgICAgICAgICAgICduZ0ZpbGVVcGxvYWQnLFxyXG4gICAgICAgICAgICAgICAgJ25nRmlsZVJlYWRlcicsXHJcbiAgICAgICAgICAgICAgICAncnpNb2R1bGUnLFxyXG4gICAgICAgICAgICAgICAgJ3N3aXRjaGVyJyxcclxuICAgICAgICAgICAgICAgICdnZmwudGV4dEF2YXRhcicsXHJcbiAgICAgICAgICAgICAgICAndGV4dEFuZ3VsYXInLFxyXG4gICAgICAgICAgICAgICAgJ3VpLmJvb3RzdHJhcC5kYXRldGltZXBpY2tlcicsXHJcbiAgICAgICAgICAgICAgICAnYW5ndWxhci1jb25maXJtJywgXHJcbiAgICAgICAgICAgICAgICAndG9hc3RyJ1xyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgKTsgXHJcblxyXG4gICAgICAgIG1vZHVsZS5jb25maWcoWyd0b2FzdHJDb25maWcnLCBmdW5jdGlvbiAodG9hc3RyQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHRvYXN0ckNvbmZpZywge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb25DbGFzczogJ3RvYXN0LWJvdHRvbS1yaWdodCcsXHJcbiAgICAgICAgICAgICAgICBuZXdlc3RPblRvcDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGFsbG93SHRtbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjbG9zZUJ1dHRvbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjbG9zZUh0bWw6ICc8YnV0dG9uPiZ0aW1lczs8L2J1dHRvbj4nLFxyXG4gICAgICAgICAgICAgICAgZXh0ZW5kZWRUaW1lT3V0OiAxMDAwLFxyXG4gICAgICAgICAgICAgICAgaWNvbkNsYXNzZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogJ3RvYXN0LWVycm9yJyxcclxuICAgICAgICAgICAgICAgICAgICBpbmZvOiAndG9hc3QtaW5mbycsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogJ3RvYXN0LXN1Y2Nlc3MnLFxyXG4gICAgICAgICAgICAgICAgICAgIHdhcm5pbmc6ICd0b2FzdC13YXJuaW5nJ1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VDbGFzczogJ3RvYXN0LW1lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgICAgb25IaWRkZW46IG51bGwsXHJcbiAgICAgICAgICAgICAgICBvblNob3duOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgb25UYXA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzc0JhcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB0YXBUb0Rpc21pc3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICB0b2FzdDogJ2RpcmVjdGl2ZXMvdG9hc3QvdG9hc3QuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NiYXI6ICdkaXJlY3RpdmVzL3Byb2dyZXNzYmFyL3Byb2dyZXNzYmFyLmh0bWwnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgdGltZU91dDogNTAwMCxcclxuICAgICAgICAgICAgICAgIHRpdGxlQ2xhc3M6ICd0b2FzdC10aXRsZScsXHJcbiAgICAgICAgICAgICAgICB0b2FzdENsYXNzOiAndG9hc3QnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1dKTtcclxuXHJcbiAgICB9XHJcbikoKTsiLCIvL2RlbW9ncmFwaGljLWxpc3QuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsIGxvZykge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG5cclxuICAgICAgICAkY3RybC50aXRsZSA9ICdEZW1vZ3JhcGhpYyBVcGRhdGVzJztcclxuICAgICAgICAkY3RybC5kZXNjcmlwdGlvbiA9ICdVcGRhdGVzIG1hZGUgdG8gY29uc3RpdHVlbnQgZGF0YSc7XHJcbiAgICAgICAgJGN0cmwuc3ViVGl0bGUgPSAnRGVtb2dyYXBoaWNzJztcclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC5zb3VyY2VzID0gW1xyXG4gICAgICAgICAgICB7IGlkOiBudWxsLCBuYW1lOiAnJyB9LFxyXG4gICAgICAgICAgICB7IGlkOiAwLCBuYW1lOiAnVGF4JyB9LFxyXG4gICAgICAgICAgICB7IGlkOiAxLCBuYW1lOiAnUlNWUCcgfVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7IGNvbnNvbGUubG9nKCdldmVudCBkZXRhaWwgaW5pdCcpOyB9XHJcblxyXG4gICAgICAgICRjdHJsLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG4gICAgICAgICAgICAkY3RybC5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VhcmNoJywgJGN0cmwuc2VhcmNoTW9kZWwpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZSkgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsLm9yZGVyQnkgPSB0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwub3JkZXJEaXJlY3Rpb24gPSB0YWJsZVN0YXRlLnNvcnQucmV2ZXJzZSA/ICdkZXNjJyA6ICdhc2MnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvZGVtb2dyYXBoaWMnLCB7IHBhcmFtczogJGN0cmwuc2VhcmNoTW9kZWwgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuZGVtb2dyYXBoaWNzID0gci5kYXRhLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRjdHJsLnNlYXJjaE1vZGVsLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMnLCBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ09vcHMgJyArIGVyci5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmRlbGV0ZSA9IGZ1bmN0aW9uIChkKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkJywgZCk7XHJcbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnYXBpL2RlbW9ncmFwaGljLycgKyBkLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwuZGVtb2dyYXBoaWNzLmluZGV4T2YoZCk7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5kZW1vZ3JhcGhpY3Muc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICBsb2cuc3VjY2VzcygnUmVjb3JkIHVwZGF0ZWQnKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMnLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcuICcgKyBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5kZWxldGVBbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJ2FwaS9kZW1vZ3JhcGhpYycpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKCdVcGRhdGVkIGFsbCByZWNvcmRzJyk7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMnLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgbG9nLmVycm9yKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZy4gJyArIGVyci5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5leHBvcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL2RlbW9ncmFwaGljL2V4cG9ydCcsIHsgcGFyYW1zOiAkY3RybC5zZWFyY2hNb2RlbCB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudFR5cGUgPSBkYXRhLmhlYWRlcnMoKVsnY29udGVudC10eXBlJ107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5oZWFkZXJzKClbJ3gtZmlsZW5hbWUnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmtFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2RhdGEuZGF0YV0sIHsgdHlwZTogY29udGVudFR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGZpbGVuYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGlja0V2ZW50ID0gbmV3IE1vdXNlRXZlbnQoXCJjbGlja1wiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZpZXdcIjogd2luZG93LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJidWJibGVzXCI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNhbmNlbGFibGVcIjogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LmRpc3BhdGNoRXZlbnQoY2xpY2tFdmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAkY3RybC5wYWdlZCA9IGZ1bmN0aW9uIHBhZ2VkKCkge1xyXG4gICAgICAgICAgICAkY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnZGVtb2dyYXBoaWNMaXN0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2RlbW9ncmFwaGljcy9kZW1vZ3JhcGhpYy1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICd0b2FzdHInLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG59XHJcbikoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9jbGVhci1rZXkuZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcImNsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgZWwub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggIT09IDI3KSB7IHJldHVybjsgfSAvLyBjaGVjayBrZXkgaG93IHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZGF0ZS1mb3JtYXQuZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnZGF0ZUZvcm1hdCcsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkYXRlRmlsdGVyLCAkcGFyc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQUMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmU6ICc/bmdNb2RlbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgbmdNb2RlbCwgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24gKHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVGaWx0ZXIodmlld1ZhbHVlLCAnTU0vZGQveXl5eSBoOm1tIGEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9kYXRlLWhpZ2hlci10aGFuLmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKCdkYXRlSGlnaGVyVGhhbicsXHJcbiAgICAgICAgZnVuY3Rpb24gKCR3aW5kb3cpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHJlcXVpcmU6ICdebmdNb2RlbCcsXHJcbiAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1vbWVudCA9ICR3aW5kb3cubW9tZW50O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0LCBmXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbGlkYXRlID0gZnVuY3Rpb24gKHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcGFyaXNvbk1vZGVsID0gYXR0cnMuZGF0ZUhpZ2hlclRoYW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb25Nb2RlbCA9IGNvbXBhcmlzb25Nb2RlbC5yZXBsYWNlKC9bXCInXS9nLCBcIlwiKSArICdaJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdmlld1ZhbHVlIHx8ICFjb21wYXJpc29uTW9kZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdkYXRlSGlnaGVyVGhhbicsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0VmFsaWRpdHkoJ2RhdGVIaWdoZXJUaGFuJywgbW9tZW50KGNvbXBhcmlzb25Nb2RlbCkuaXNCZWZvcmUobW9tZW50KHZpZXdWYWx1ZSkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRwYXJzZXJzLnVuc2hpZnQodmFsaWRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJGZvcm1hdHRlcnMucHVzaCh2YWxpZGF0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCdkYXRlSGlnaGVyVGhhbicsIGZ1bmN0aW9uIChjb21wYXJpc29uTW9kZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2hlbmV2ZXIgdGhlIGNvbXBhcmlzb24gbW9kZWwgY2hhbmdlcyB3ZSdsbCByZS12YWxpZGF0ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGUoY3RybC4kdmlld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgKTtcclxuXHJcbn0pKCk7XHJcblxyXG4iLCIvL21hcmsubGF3cmVuY2VcclxuLy9kYXRlLWlucHV0LmRpcmVjdGl2ZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2RhdGVJbnB1dCcsIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWlyZTogJ15uZ01vZGVsJyxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbW9tZW50ID0gJHdpbmRvdy5tb21lbnQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZUZvcm1hdCA9IGF0dHJzLmRhdGVJbnB1dDtcclxuXHJcbiAgICAgICAgICAgICAgICBhdHRycy4kb2JzZXJ2ZSgnZGF0ZUlucHV0JywgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVGb3JtYXQgPT09IG5ld1ZhbHVlIHx8ICFjdHJsLiRtb2RlbFZhbHVlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRtb2RlbFZhbHVlID0gbW9tZW50KGN0cmwuJHNldFZpZXdWYWx1ZSkuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY3RybC4kZm9ybWF0dGVycy51bnNoaWZ0KGZ1bmN0aW9uIChtb2RlbFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkYXRlRm9ybWF0IHx8ICFtb2RlbFZhbHVlKSByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gbW9tZW50KG1vZGVsVmFsdWUpLmZvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY3RybC4kcGFyc2Vycy51bnNoaWZ0KGZ1bmN0aW9uICh2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG1vbWVudCh2aWV3VmFsdWUsIGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0ZSAmJiBkYXRlLmlzVmFsaWQoKSAmJiBkYXRlLnllYXIoKSA+IDE5NTApID8gZGF0ZS50b0RhdGUoKSA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9kYXRlLWxvd2VyLXRoYW4uZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2RhdGVMb3dlclRoYW4nLFxyXG4gICAgICAgIGZ1bmN0aW9uICgkd2luZG93KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICByZXF1aXJlOiAnXm5nTW9kZWwnLFxyXG4gICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtb21lbnQgPSAkd2luZG93Lm1vbWVudDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdCwgZlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWxpZGF0ZSA9IGZ1bmN0aW9uICh2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBhcmlzb25Nb2RlbCA9IGF0dHJzLmRhdGVMb3dlclRoYW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb25Nb2RlbCA9IGNvbXBhcmlzb25Nb2RlbC5yZXBsYWNlKC9bXCInXS9nLCBcIlwiKSArICdaJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdmlld1ZhbHVlIHx8ICFjb21wYXJpc29uTW9kZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHNldFZhbGlkaXR5KCdkYXRlTG93ZXJUaGFuJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWYWxpZGl0eSgnZGF0ZUxvd2VyVGhhbicsIG1vbWVudChjb21wYXJpc29uTW9kZWwpLmlzQWZ0ZXIobW9tZW50KHZpZXdWYWx1ZSkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRwYXJzZXJzLnVuc2hpZnQodmFsaWRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJGZvcm1hdHRlcnMucHVzaCh2YWxpZGF0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCdkYXRlTG93ZXJUaGFuJywgZnVuY3Rpb24gKGNvbXBhcmlzb25Nb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXaGVuZXZlciB0aGUgY29tcGFyaXNvbiBtb2RlbCBjaGFuZ2VzIHdlJ2xsIHJlLXZhbGlkYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZShjdHJsLiR2aWV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICApO1xyXG5cclxufSkoKTtcclxuXHJcbiIsIi8vZXZlbnQtdXJsLmRpcmVjdGl2ZS5qc1xyXG5cclxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbmFwcC5kaXJlY3RpdmUoJ3VybEF2YWlsYWJsZScsIGZ1bmN0aW9uICgkcSwgJHRpbWVvdXQsICRodHRwKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJywgXHJcbiAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiAnQCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgY3RybC4kYXN5bmNWYWxpZGF0b3JzLnVuaXF1ZSA9IGZ1bmN0aW9uIChtb2RlbFZhbHVlLCB2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWYgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gbW9kZWxWYWx1ZSB8fCB2aWV3VmFsdWUgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5pdGlhbFZhbHVlID0gc2NvcGUuaW5pdGlhbFZhbHVlIHx8ICcnO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghY3RybCB8fCAhZWxlbWVudC52YWwoKSB8fCAhY3RybC4kZGlydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWYucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWYucHJvbWlzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRvTG93ZXJDYXNlKCkgIT09IGluaXRpYWxWYWx1ZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvZXZlbnQvZXZlbnRuYW1ldXJsYXZhaWxhYmxlLycgKyBtb2RlbFZhbHVlKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyLmRhdGEpIHsgZGVmLnJlc29sdmUoKTsgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsgZGVmLnJlamVjdCgnVXJsIGV4aXN0cycpOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWYucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZi5wcm9taXNlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pO1xyXG5cclxuXHJcbiIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL3NtYXJ0LXRhYmxlLmNsZWFyS2V5LmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcInN0Q2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJ15zdFRhYmxlJywgJ15uZ01vZGVsJ10sXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5nTW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAyNykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY29udGV4dC5hdHRyaWJ1dGVzWydzdC1zZWFyY2gnXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVN0YXRlID0gY3RybC50YWJsZVN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0W2ZpZWxkTmFtZV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kcmVuZGVyKCk7IC8vIHdpbGwgdXBkYXRlIHRoZSBpbnB1dCB2YWx1ZSBhcyB3ZWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKFwic3RSZXNldFNlYXJjaFwiLFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmU6IFsnXnN0VGFibGUnLCAnXm5nTW9kZWwnXSxcclxuICAgICAgICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJscykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5iaW5kKCdjbGljaycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gY3RybHNbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN0cmwgPSBjdHJsc1swXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChtb2RlbC4kdmlld1ZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LnRvTG93ZXJDYXNlKCkgPT09ICdwYWdlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC4kdmlld1ZhbHVlW2tleV0gPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgXy5pbmNsdWRlcyhrZXkudG9Mb3dlckNhc2UoKSwgJ3BhZ2UnKSkgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLiR2aWV3VmFsdWVba2V5XSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlU3RhdGUgPSBjdHJsLnRhYmxlU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUucGFnaW5hdGlvbi5zdGFydCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ3N0U3VibWl0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZUN0cmwgPSBjdHJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdzbWFydC10YWJsZScpXHJcbiAgICAgIC5kaXJlY3RpdmUoJ3N0U2VhcmNoJywgWydzdENvbmZpZycsICckdGltZW91dCcsICckcGFyc2UnLCBmdW5jdGlvbiAoc3RDb25maWcsICR0aW1lb3V0LCAkcGFyc2UpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgcmVxdWlyZTogJ15zdFRhYmxlJyxcclxuICAgICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlQ3RybCA9IGN0cmw7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgdmFyIHRocm90dGxlID0gYXR0ci5zdERlbGF5IHx8IHN0Q29uZmlnLnNlYXJjaC5kZWxheTtcclxuICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gYXR0ci5zdElucHV0RXZlbnQgfHwgc3RDb25maWcuc2VhcmNoLmlucHV0RXZlbnQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICBhdHRyLiRvYnNlcnZlKCdzdFNlYXJjaCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsZW1lbnRbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIGlucHV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC50YWJsZVN0YXRlKCkuc2VhcmNoID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVDdHJsLnNlYXJjaChpbnB1dCwgbmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgIC8vdGFibGUgc3RhdGUgLT4gdmlld1xyXG4gICAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwudGFibGVTdGF0ZSgpLnNlYXJjaDtcclxuICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHByZWRpY2F0ZUV4cHJlc3Npb24gPSBhdHRyLnN0U2VhcmNoIHx8ICckJztcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZS5wcmVkaWNhdGVPYmplY3QgJiYgJHBhcnNlKHByZWRpY2F0ZUV4cHJlc3Npb24pKG5ld1ZhbHVlLnByZWRpY2F0ZU9iamVjdCkgIT09IGVsZW1lbnRbMF0udmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnZhbHVlID0gJHBhcnNlKHByZWRpY2F0ZUV4cHJlc3Npb24pKG5ld1ZhbHVlLnByZWRpY2F0ZU9iamVjdCkgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgLy8gdmlldyAtPiB0YWJsZSBzdGF0ZVxyXG4gICAgICAgICAgICAgICAgICBlbGVtZW50LmJpbmQoZXZlbnQsIGZ1bmN0aW9uIChldnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGV2dCA9IGV2dC5vcmlnaW5hbEV2ZW50IHx8IGV2dDtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9taXNlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHByb21pc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVDdHJsLnNlYXJjaChldnQudGFyZ2V0LnZhbHVlLCBhdHRyLnN0U2VhcmNoIHx8ICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgIH0sIHRocm90dGxlKTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuICAgICAgfV0pO1xyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgYXBwLmRpcmVjdGl2ZSgndG9nZ2xlQ2hlY2tib3gnLCBmdW5jdGlvbigkdGltZW91dCkge1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAqIERpcmVjdGl2ZVxyXG4gICAgICovXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgcmVwbGFjZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCwgJGF0dHIsIG5nTW9kZWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgbW9kZWwgZnJvbSBFbGVtZW50XHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlTW9kZWxGcm9tRWxlbWVudCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIG1vZGlmaWVkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSAkZWxlbWVudC5wcm9wKCdjaGVja2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrZWQgIT09IG5nTW9kZWwuJHZpZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbmdNb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoY2hlY2tlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBpbnB1dCBmcm9tIE1vZGVsXHJcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlRWxlbWVudEZyb21Nb2RlbCA9IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQudHJpZ2dlcignY2hhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE9ic2VydmU6IEVsZW1lbnQgY2hhbmdlcyBhZmZlY3QgTW9kZWxcclxuICAgICAgICAgICAgICAgICRlbGVtZW50Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVNb2RlbEZyb21FbGVtZW50KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZ01vZGVsLiR2aWV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZUVsZW1lbnRGcm9tTW9kZWwobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbGlzZSBCb290c3RyYXBUb2dnbGVcclxuICAgICAgICAgICAgICAgICRlbGVtZW50LmJvb3RzdHJhcFRvZ2dsZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vY29uc3RpdHVlbnQtZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb25zdGl0dWVudCBlZGl0IGluaXQnKTtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnBlcnNvbiA9IGFuZ3VsYXIuY29weSgkY3RybC5yZXNvbHZlLnBlcnNvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRjdHJsLnRpdGxlID0gJGN0cmwucGVyc29uLm5hbWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzYXZlJywgJGN0cmwucGVyc29uKTtcclxuICAgICAgICAgICAgJGh0dHAucHV0KCdhcGkvY29uc3RpdHVlbnQnLCAkY3RybC5wZXJzb24pLnRoZW4oZnVuY3Rpb24ocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZSgkY3RybC5wZXJzb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnY29uc3RpdHVlbnRFZGl0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICBwZXJzb246ICc8JyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvZG9ub3J0YXgvY29uc3RpdHVlbnQtZWRpdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy90YXgtbGlzdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgdG9hc3RyLCAkbW9kYWwpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG4gICAgICAgIHZhciBwYWdlU2l6ZURlZmF1bHQgPSAxMDtcclxuXHJcbiAgICAgICAgJGN0cmwudGl0bGUgPSAnRG9ub3IgVGF4IE1hbmFnZXInO1xyXG4gICAgICAgICRjdHJsLnN1YlRpdGxlID0gJ0NvbnN0aXR1ZW50cyc7XHJcblxyXG4gICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LFxyXG4gICAgICAgICAgICBvcmRlckJ5OiAnaWQnLFxyXG4gICAgICAgICAgICBvcmRlckRpcmVjdGlvbjogJ2FzYydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygndGF4IGxpc3QgaW5pdCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlKSAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbC5vcmRlckRpcmVjdGlvbiA9IHRhYmxlU3RhdGUuc29ydC5yZXZlcnNlID8gJ2Rlc2MnIDogJ2FzYyc7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtb2RlbCcsICRjdHJsLnNlYXJjaE1vZGVsKTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvY29uc3RpdHVlbnQnLCB7IHBhcmFtczogJGN0cmwuc2VhcmNoTW9kZWwgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwucGVvcGxlID0gci5kYXRhLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRjdHJsLnNlYXJjaE1vZGVsLnJlc3VsdHM7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwucGFnZWQgPSBmdW5jdGlvbiBwYWdlZChwYWdlTnVtKSB7XHJcbiAgICAgICAgICAgICRjdHJsLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC5lZGl0ID0gZnVuY3Rpb24gKHBlcnNvbikge1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdjb25zdGl0dWVudEVkaXQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBwZXJzb246IHBlcnNvblxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdsZydcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQocGVyc29uLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1NhdmVkICcgKyByZXN1bHQubmFtZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC52aWV3VGF4ZXMgPSBmdW5jdGlvbiAocGVyc29uKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd2aWV3IHRheCcsIHBlcnNvbik7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ3RheERldGFpbCcsXHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcnNvbjogcGVyc29uXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xyXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1NhdmVkICcgKyByZXN1bHQudGl0bGUpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdjb25zdGl0dWVudExpc3QnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvZG9ub3J0YXgvY29uc3RpdHVlbnQtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAndG9hc3RyJywgJyR1aWJNb2RhbCcsIGNvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcbn1cclxuKSgpOyIsIi8vdGF4LWRldGFpbC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0WWVhcnMoY3VycmVudFllYXIpIHtcclxuICAgICAgICB2YXIgeWVhcnMgPSBbXTtcclxuICAgICAgICAvL3ZhciBjdXJyZW50WWVhciA9IHBhcnNlSW50KG1vbWVudCgpLmdldCgnWWVhcicpKTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICAgICAgeWVhcnMucHVzaChjdXJyZW50WWVhciAtIGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4geWVhcnM7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgdG9hc3RyKSB7XHJcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcclxuICAgICAgICB2YXIgY3VycmVudFllYXIgPSBwYXJzZUludChtb21lbnQoKS5nZXQoJ1llYXInKSk7XHJcblxyXG4gICAgICAgICRjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0YXggZGV0YWlsIGluaXQnKTtcclxuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgJGN0cmwubmV3SXRlbSA9IHt9O1xyXG5cclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnBlcnNvbiA9ICRjdHJsLnJlc29sdmUucGVyc29uO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkY3RybC50aXRsZSA9ICRjdHJsLnBlcnNvbi5maXJzdE5hbWUgKyAnICcgKyAkY3RybC5wZXJzb24ubGFzdE5hbWU7XHJcbiAgICAgICAgICAgICRjdHJsLnNlbGVjdGVkWWVhciA9IGN1cnJlbnRZZWFyIC0gMTtcclxuICAgICAgICAgICAgJGN0cmwueWVhcnMgPSBnZXRZZWFycyhjdXJyZW50WWVhcik7XHJcbiAgICAgICAgICAgICRjdHJsLnllYXJDaGFuZ2UoKTtcclxuXHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL3RheC8nICsgJGN0cmwucGVyc29uLmxvb2t1cElkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC50YXhJdGVtcyA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5hZGRJdGVtID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAkY3RybC5uZXdJdGVtLmNvbnN0aXR1ZW50SWQgPSAkY3RybC5wZXJzb24uaWQ7XHJcbiAgICAgICAgICAgICRjdHJsLm5ld0l0ZW0udGF4WWVhciA9IG1vbWVudCgkY3RybC5uZXdJdGVtLmRvbmF0aW9uRGF0ZSkueWVhcigpO1xyXG5cclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL3RheCcsICRjdHJsLm5ld0l0ZW0gKS50aGVuKGZ1bmN0aW9uKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnRheEl0ZW1zLnB1c2goci5kYXRhKTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCdTYXZlZCB0YXggZW50cnknKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ09vcHMuIEVycm9yIGNyZWF0aW5nIHRheCBlbnRyeScpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7IFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsRWRpdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLmRlbGV0ZSA9IGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnYXBpL3RheC8nICsgaXRlbS5pZCkudGhlbihmdW5jdGlvbihyKSB7XHJcbiAgICAgICAgICAgICAgICB0b2FzdHIud2FybmluZygnRGVsZXRlIHRheCBpdGVtICcgKyBpdGVtLmFtb3VudCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwudGF4SXRlbXMuaW5kZXhPZihpdGVtKTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnRheEl0ZW1zLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcy4gRXJyb3IgZGVsZXRpbmcgdGF4Jyk7XHJcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuZWRpdCA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpdGVtJywgaXRlbSk7XHJcbiAgICAgICAgICAgICRjdHJsLmN1cnJlbnRFZGl0ID0ge307XHJcbiAgICAgICAgICAgICRjdHJsLmN1cnJlbnRFZGl0W2l0ZW0uaWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgJGN0cmwuaXRlbVRvRWRpdCA9IGFuZ3VsYXIuY29weShpdGVtKTtcclxuICAgICAgICAgICAgJGN0cmwuaXRlbVRvRWRpdC5kb25hdGlvbkRhdGUgPSBtb21lbnQoJGN0cmwuaXRlbVRvRWRpdC5kb25hdGlvbkRhdGUpLnRvRGF0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2F2ZSA9IGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRodHRwLnB1dCgnYXBpL3RheCcsICRjdHJsLml0ZW1Ub0VkaXQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGl0ZW0sIHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygnVXBkYXRlZCB0YXggaXRlbSAnICsgbW9tZW50KGl0ZW0uZG9uYXRpb25EYXRlKS5mb3JtYXQoJ01NL2RkL3l5eXknKSk7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ0Vycm9yIHNhdmluZyB0YXggZW50cnknKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7IFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC55ZWFyQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5kYXRlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIG1heERhdGU6IG5ldyBEYXRlKCcxMi8zMC8nICsgJGN0cmwuc2VsZWN0ZWRZZWFyKSxcclxuICAgICAgICAgICAgICAgIG1pbkRhdGU6IG5ldyBEYXRlKCcxLzEvJyArICRjdHJsLnNlbGVjdGVkWWVhcilcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJGN0cmwubmV3SXRlbS5kb25hdGlvbkRhdGUgPSAkY3RybC5kYXRlT3B0aW9ucy5taW5EYXRlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgndGF4RGV0YWlsJyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICBwZXJzb246ICc8JyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvZG9ub3J0YXgvdGF4LWRldGFpbHMuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgJ3RvYXN0cicsIGNvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcblxyXG59XHJcbikoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9lbnYuanNcclxuXHJcbihmdW5jdGlvbiAod2luZG93KSB7XHJcbiAgICB3aW5kb3cuX19lbnYgPSB3aW5kb3cuX19lbnYgfHwge307XHJcblxyXG4gICAgc3dpdGNoICh3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUpIHtcclxuICAgICAgICBjYXNlICdkb25vcmdhdGV3YXlzdGFnZS5henVyZXdlYnNpdGVzLm5ldCc6XHJcbiAgICAgICAgICAgIHdpbmRvdy5fX2Vudi5yc3ZwVXJsID0gJ2V2ZW50cnN2cHN0YWdlLmF6dXJld2Vic2l0ZXMubmV0JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZG9ub3JnYXRld2F5c3RhZ2Uuc3BsY2VudGVyLm9yZyc6XHJcbiAgICAgICAgICAgIHdpbmRvdy5fX2Vudi5yc3ZwVXJsID0gJ3JzdnBzdGFnZS5zcGxjZW50ZXIub3JnJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZG9ub3JnYXRld2F5LnNwbGNlbnRlci5vcmcnOlxyXG4gICAgICAgICAgICB3aW5kb3cuX19lbnYucnN2cFVybCA9ICdyc3ZwLnNwbGNlbnRlci5vcmcnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdkb25vcmdhdGV3YXkuYXp1cmV3ZWJzaXRlcy5uZXQnOlxyXG4gICAgICAgICAgICB3aW5kb3cuX19lbnYucnN2cFVybCA9ICdldmVudHJzdnAuYXp1cmV3ZWJzaXRlcy5uZXQnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB3aW5kb3cuX19lbnYucnN2cFVybCA9ICdsb2NhbGhvc3Q6NTMxNzInO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFQSSB1cmxcclxuICAgIHdpbmRvdy5fX2Vudi5hcGlVcmwgPSAnaHR0cDovLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArICcvYXBpJztcclxuXHJcbiAgICAvLyBCYXNlIHVybFxyXG4gICAgd2luZG93Ll9fZW52LmJhc2VVcmwgPSAnLyc7XHJcblxyXG4gICAgLy8gV2hldGhlciBvciBub3QgdG8gZW5hYmxlIGRlYnVnIG1vZGVcclxuICAgIC8vIFNldHRpbmcgdGhpcyB0byBmYWxzZSB3aWxsIGRpc2FibGUgY29uc29sZSBvdXRwdXRcclxuICAgIHdpbmRvdy5fX2Vudi5lbmFibGVEZWJ1ZyA9IHRydWU7XHJcbn0odGhpcykpOyIsIi8vZXZlbnQtY3JlYXRlLmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBldmVudENyZWF0ZUNvbnRyb2xsZXIoJGh0dHAsIGxvZykge1xyXG4gICAgICAgIHZhciBjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgY3RybC50aXRsZSA9ICdDcmVhdGUgRXZlbnQnO1xyXG4gICAgICAgIGN0cmwuZGF0ZUZvcm1hdCA9IFwiTU0vREQvWVlZWSBoOm1tIEFcIjtcclxuXHJcbiAgICAgICAgY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjdHJsLmV2ZW50ID0ge1xyXG4gICAgICAgICAgICAgICAgc3RhcnREYXRlOiBtb21lbnQobmV3IERhdGUoKSkuYWRkKDEsICdob3VyJykuc3RhcnRPZignaG91cicpLFxyXG4gICAgICAgICAgICAgICAgZW5kRGF0ZTogbW9tZW50KG5ldyBEYXRlKCkpLmFkZCg1LCAnZGF5cycpLnN0YXJ0T2YoJ2hvdXInKSxcclxuICAgICAgICAgICAgICAgIGNhcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IHt9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJ2FwaS9ldmVudCcsIGN0cmwuZXZlbnQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGN0cmwuZXZlbnQsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2UoY3RybC5ldmVudCk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZyBzYXZpbmcgZXZlbnQnLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgbG9nLmVycm9yKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZyBzYXZpbmcgZXZlbnQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb252ZXJ0RGF0ZShkYXRlKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRlKSByZXR1cm4gbW9tZW50KGRhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERFRISDptbScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnZXZlbnRDcmVhdGUnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvZXZlbnRzL2V2ZW50LWNyZWF0ZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAndG9hc3RyJywgZXZlbnRDcmVhdGVDb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG5cclxufVxyXG4pKCk7IiwiLy9ldmVudC1kYXNoYm9hcmQuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGV2ZW50RGFzaGJvYXJkQ29udHJvbGxlcigkaHR0cCwgJG1vZGFsLCB0b2FzdHIpIHtcclxuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgIGN0cmwudGl0bGUgPSAnRXZlbnQgTWFuYWdlcic7XHJcbiAgICAgICAgY3RybC5kZXNjcmlwdGlvbiA9IFwiTWFuYWdlIERvbm9yIEV2ZW50c1wiO1xyXG5cclxuICAgICAgICBjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdldmVudCBkYXNoYm9hcmQgaW5pdCcpO1xyXG4gICAgICAgICAgICBjdHJsLmlzQnVzeSA9IHRydWU7IFxyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9ldmVudCcpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuZXZlbnRzID0gci5kYXRhO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9vcHMuIENhbid0IGdldCBsaXN0IG9mIGV2ZW50c1wiLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiT29wcy4gQ2FuJ3QgZ2V0IGxpc3Qgb2YgZXZlbnRzXCIpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5jcmVhdGUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnZXZlbnRDcmVhdGUnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgY3RybC5zZWxlY3RlZEV2ZW50ID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgY3RybC5ldmVudHMudW5zaGlmdChjdHJsLnNlbGVjdGVkRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbGVjdGVkIGV2ZW50JywgY3RybC5zZWxlY3RlZEV2ZW50KTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5pbmZvKCdDcmVhdGVkIEV2ZW50ICcgKyByZXN1bHQubmFtZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgfSk7ICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLmNoYW5nZUV2ZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGN0cmwuc2VsZWN0ZWRFdmVudElkID0gY3RybC5zZWxlY3RlZEV2ZW50LmlkOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuZXZlbnREZWxldGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBpZHggPSBjdHJsLmV2ZW50cy5pbmRleE9mKGN0cmwuc2VsZWN0ZWRFdmVudCk7XHJcbiAgICAgICAgICAgIGN0cmwuZXZlbnRzLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICBjdHJsLnNlbGVjdGVkRXZlbnQgPSBudWxsOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuZXZlbnRVcGRhdGVkID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGN0cmwuaXNCdXN5ID0gdHJ1ZTsgXHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGN0cmwuc2VsZWN0ZWRFdmVudCwgZXZlbnQpO1xyXG4gICAgICAgICAgICBjdHJsLmlzQnVzeSA9IGZhbHNlOyBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnZXZlbnREYXNoYm9hcmQnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvZXZlbnRzL2V2ZW50LWRhc2hib2FyZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgJ3RvYXN0cicsIGV2ZW50RGFzaGJvYXJkQ29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxufVxyXG4pKCk7IiwiLy9ldmVudC1kZXRhaWwuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHBhcnNlRXJyb3JzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgdmFyIGVycm9ycyA9IFtdO1xyXG4gICAgICAgIHZhciBrZXk7XHJcbiAgICAgICAgZm9yIChrZXkgaW4gcmVzcG9uc2UubW9kZWxTdGF0ZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UubW9kZWxTdGF0ZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLm1vZGVsU3RhdGVba2V5XS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICckaWQnKSBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChyZXNwb25zZS5tb2RlbFN0YXRlW2tleV1baV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBlcnJvcnM7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZXZlbnREZXRhaWxDb250cm9sbGVyKCRodHRwLCBsb2csICRzY29wZSkge1xyXG4gICAgICAgIHZhciBjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgY3RybC5kYXRlRm9ybWF0ID0gXCJNTS9ERC9ZWVlZIGg6bW0gQVwiO1xyXG4gICAgICAgIGN0cmwuaG9zdExvY2F0aW9uID0gd2luZG93Ll9fZW52LnJzdnBVcmwgKyAnLyc7XHJcblxyXG4gICAgICAgIGN0cmwuJG9uQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5yZWZyZXNoRXZlbnQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHsgY29uc29sZS5sb2coJ2V2ZW50IGRldGFpbCBpbml0Jyk7IH1cclxuXHJcbiAgICAgICAgY3RybC5yZWZyZXNoRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChjdHJsLmV2ZW50SWQgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL2V2ZW50LycgKyBjdHJsLmV2ZW50SWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuZXZlbnQgPSByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBjdHJsLm5hbWVVcmwgPSByLmRhdGEubmFtZVVybDtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09wcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJ2FwaS9ldmVudC8nICsgY3RybC5ldmVudElkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmV2ZW50ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGxvZy53YXJuaW5nKCdEZWxldGVkIGV2ZW50Jyk7XHJcbiAgICAgICAgICAgICAgICBjdHJsLm9uRGVsZXRlKCk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZyBkZWxldGluZyBldmVudCcsIGVycik7XHJcbiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nIGRlbGV0aW5nIGV2ZW50Jyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuc2F2ZUV2ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQoJ2FwaS9ldmVudCcsIGN0cmwuZXZlbnQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGN0cmwuZXZlbnQsIHIuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nLnN1Y2Nlc3MoJ1VwZGF0ZWQgJyArIGN0cmwuZXZlbnQuaW5pdGlhdGl2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5vblVwZGF0ZWQoeyBldmVudDogY3RybC5ldmVudCB9KTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT29wcy4gU29tZXRoaW5nIHdlbnQgd3Jvbmcgc2F2aW5nIGV2ZW50Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nLmVycm9yKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZyBzYXZpbmcgZXZlbnQnKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmVycm9ycyA9IHBhcnNlRXJyb3JzKGVyci5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwudG9nZ2xlQ2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjdHJsLmV2ZW50LmlzQ2FuY2VsbGVkID0gIWN0cmwuZXZlbnQuaXNDYW5jZWxsZWQ7XHJcbiAgICAgICAgICAgIGN0cmwuc2F2ZUV2ZW50KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb252ZXJ0RGF0ZShkYXRlKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRlKSByZXR1cm4gbW9tZW50KGRhdGUpLmZvcm1hdCgnWVlZWS1NTS1ERFRISDptbScpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdldmVudERldGFpbCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgb25EZWxldGU6ICcmJyxcclxuICAgICAgICAgICAgICAgIGV2ZW50SWQ6ICc8JyxcclxuICAgICAgICAgICAgICAgIG9uVXBkYXRlZDogJyYnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2V2ZW50cy9ldmVudC1kZXRhaWwuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgJ3RvYXN0cicsICckc2NvcGUnLCBldmVudERldGFpbENvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcbn1cclxuKSgpOyIsIi8vZXZlbnQtdGVtcGxhdGUuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGV2ZW50VGVtcGxhdGVDb250cm9sbGVyKCRzY29wZSwgJGh0dHAsIGxvZykge1xyXG4gICAgICAgIHZhciBjdHJsID0gdGhpcztcclxuXHJcbiAgICAgICAgY3RybC50aXRsZSA9ICdFdmVudCBUZW1wbGF0ZSc7XHJcbiAgICAgICAgY3RybC5kZXNjcmlwdGlvbiA9IFwiVXBkYXRlIEV2ZW50IFRlbXBsYXRlXCI7XHJcblxyXG4gICAgICAgIGN0cmwuJG9uQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5yZWZyZXNoKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdldmVudCB0ZW1wbGF0ZSBpbml0Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0ZW1wbGF0ZSByZWZyZXNoJyk7XHJcbiAgICAgICAgICAgIGlmIChjdHJsLnRlbXBsYXRlSWQgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL3RlbXBsYXRlLycgKyBjdHJsLnRlbXBsYXRlSWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwudGVtcGxhdGUgPSByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBjdHJsLnRlbXBsYXRlRGVsdGEgPSBhbmd1bGFyLmNvcHkoY3RybC50ZW1wbGF0ZSk7IFxyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9vcHMuIENhbid0IGdldCBldmVudCB0ZW1wbGF0ZVwiLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgbG9nLmVycm9yKFwiT29wcy4gQ2FuJ3QgZ2V0IGV2ZW50IHRlbXBsYXRlXCIpO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5jYW5jZWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY3RybC50ZW1wbGF0ZSA9IGFuZ3VsYXIuY29weShjdHJsLnRlbXBsYXRlRGVsdGEpOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5pc0J1c3kgPSB0cnVlOyBcclxuICAgICAgICAgICAgJGh0dHAucHV0KCdhcGkvdGVtcGxhdGUnLCBjdHJsLnRlbXBsYXRlKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChjdHJsLnRlbXBsYXRlLCByLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgY3RybC50ZW1wbGF0ZURlbHRhID0gYW5ndWxhci5jb3B5KGN0cmwudGVtcGxhdGUpO1xyXG4gICAgICAgICAgICAgICAgbG9nLnN1Y2Nlc3MoJ1VwZGF0ZWQgdGVtcGxhdGUnKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMuIEVycm9yIHVwZGF0aW5nIHRlbXBsYXRlJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcgdXBkYXRpbmcgdGVtcGxhdGU6ICcgKyBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuaXNCdXN5ID0gZmFsc2U7IFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuZmlsZVNlbGVjdGVkID0gZnVuY3Rpb24gKCRmaWxlcywgJGZpbGUpIHtcclxuXHJcbiAgICAgICAgICAgIGN0cmwuaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdmFyIGZpbGUgPSAkZmlsZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzcmMgPSAnJztcclxuICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcblxyXG4gICAgICAgICAgICByZWFkZXIub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7IH1cclxuXHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgc3JjID0gcmVhZGVyLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIGN0cmwudGVtcGxhdGUuaW1hZ2UgPSByZWFkZXIucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgY3RybC50ZW1wbGF0ZS5taW1lVHlwZSA9IGZpbGUudHlwZTtcclxuICAgICAgICAgICAgICAgIGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZWFkZXIgZXJyb3InLCBlKTtcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignT29wcy4gRXJyb3IgcmVhZGluZyBpbWFnZScpOyBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAvL0FkZGVkIGR1ZSB0byBsYXJnZSBpbWFnZXMgbm90IGNvbXBsZXRlIGJlZm9yZSBkaWdlc3QgY3ljbGUuIFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdldmVudFRlbXBsYXRlJyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZUlkOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvZXZlbnRzL2V2ZW50LXRlbXBsYXRlLmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckc2NvcGUnLCAnJGh0dHAnLCAndG9hc3RyJywgZXZlbnRUZW1wbGF0ZUNvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcbn1cclxuKSgpOyIsIi8vZ3Vlc3QtZWRpdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZ3Vlc3RFZGl0Q29udHJvbGxlcigkaHR0cCwgbG9nKSB7XHJcbiAgICAgICAgdmFyIGN0cmwgPSB0aGlzO1xyXG4gICAgICAgIGN0cmwudGlja2V0Q291bnRMaXN0ID0gW107XHJcblxyXG4gICAgICAgIGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2d1ZXN0IGVkaXQgaW5pdCcpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGN0cmwucmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgY3RybC5pZCA9IGN0cmwucmVzb2x2ZS5ndWVzdElkO1xyXG4gICAgICAgICAgICAgICAgY3RybC5ldmVudElkID0gY3RybC5yZXNvbHZlLmV2ZW50SWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGdldEd1ZXN0RGV0YWlscygpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuZ3Vlc3QgPSByO1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwudGl0bGUgPSBjdHJsLmd1ZXN0Lm5hbWUgfHwgJ05ldyBHdWVzdCc7IFxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCAoY3RybC5ndWVzdC50aWNrZXRBbGxvd2FuY2UgfHwgNSkgKyAxOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnRpY2tldENvdW50TGlzdC5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEd1ZXN0RGV0YWlscygpIHtcclxuICAgICAgICAgICAgaWYgKGN0cmwuaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQoJ2FwaS9ldmVudC9ndWVzdC8nICsgY3RybC5pZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycicsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2cuZXJyb3IoJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nIGdldHRpbmcgZ3Vlc3QgaW5mb3JtYXRpb24nKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCgnYXBpL2V2ZW50LycgKyBjdHJsLmV2ZW50SWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBldmVudElkOiBjdHJsLmV2ZW50SWQsIHRpY2tldEFsbG93YW5jZTogci5kYXRhLnRpY2tldEFsbG93YW5jZSB9XHJcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09wcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nIGdldHRpbmcgZXZlbnQnLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuY2hhbmdlQXR0ZW5kaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoY3RybC5ndWVzdC5pc0F0dGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgY3RybC5ndWVzdC50aWNrZXRDb3VudCA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmd1ZXN0LnRpY2tldENvdW50ID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5jaGFuZ2VUaWNrZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGN0cmwuZ3Vlc3QuaXNBdHRlbmRpbmcgPSBjdHJsLmd1ZXN0LnRpY2tldENvdW50ICE9PSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGN0cmwuZGlzbWlzcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvZXZlbnQvJyArIGN0cmwuZ3Vlc3QuZXZlbnRJZCArICcvcmVnaXN0ZXIvJywgY3RybC5ndWVzdCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoY3RybC5ndWVzdCwgci5kYXRhKTtcclxuICAgICAgICAgICAgICAgIGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZShjdHJsLmd1ZXN0KTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIGxvZy5lcnJvcignT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcgcmVnaXN0ZXJpbmcgZ3Vlc3QnLCBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2d1ZXN0RWRpdCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgZ3Vlc3RJZDogJzwnLFxyXG4gICAgICAgICAgICAgICAgZXZlbnRJZDogJzwnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxyXG4gICAgICAgICAgICAgICAgY2xvc2U6ICcmJyxcclxuICAgICAgICAgICAgICAgIGRpc21pc3M6ICcmJyxcclxuICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6ICc8J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9ldmVudHMvZ3Vlc3QtZWRpdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAndG9hc3RyJywgZ3Vlc3RFZGl0Q29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vZ3Vlc3QtaW1wb3J0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBmb3JtRGF0YU9iamVjdChkYXRhKSB7XHJcbiAgICAgICAgdmFyIGZkID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgZmQuYXBwZW5kKCdmaWxlJywgZGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGZkO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGd1ZXN0SW1wb3J0Q29udHJvbGxlcigkaHR0cCwgbG9nKSB7XHJcbiAgICAgICAgdmFyIGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICBjdHJsLnRpdGxlID0gJ1VwbG9hZCBHdWVzdCBMaXN0JztcclxuXHJcbiAgICAgICAgY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ3Vlc3QgaW1wb3J0IGluaXQnKTtcclxuICAgICAgICAgICAgaWYgKGN0cmwucmVzb2x2ZSkge1xyXG4gICAgICAgICAgICAgICAgY3RybC5ldmVudElkID0gY3RybC5yZXNvbHZlLmV2ZW50SWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuZmlsZVNlbGVjdGVkID0gZnVuY3Rpb24gKCRmaWxlLCAkZXZlbnQpIHtcclxuICAgICAgICAgICAgY3RybC5yZXN1bHQgPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkbW9kYWwuZGlzbWlzcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjdHJsLmlzQnVzeSA9IHRydWU7IFxyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvZmlsZS9ndWVzdC8nICsgY3RybC5ldmVudElkLCBmb3JtRGF0YU9iamVjdChjdHJsLmZpbGUpLCB7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkIH1cclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgbG9nLnN1Y2Nlc3Moci5kYXRhLm1lc3NhZ2VzWzBdICsgJyBpbiAnICsgci5kYXRhLnRvdGFsVGltZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzcG9uc2UnLCByLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgY3RybC5pc0J1c3kgPSBmYWxzZTsgXHJcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT29wcy4gU29tZXRoaW5nIHdoZW4gd3JvbmcnLCBlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2d1ZXN0SW1wb3J0JyxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICBldmVudElkOiAnPCcsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiAnPCcsXHJcbiAgICAgICAgICAgICAgICBjbG9zZTogJyYnLFxyXG4gICAgICAgICAgICAgICAgZGlzbWlzczogJyYnLFxyXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2V2ZW50cy9ndWVzdC1pbXBvcnQuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgJ3RvYXN0cicsIGd1ZXN0SW1wb3J0Q29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxuXHJcbn1cclxuKSgpOyIsIi8vZ3Vlc3QtbGlzdC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZ3Vlc3RMaXN0Q29udHJvbGxlcigkaHR0cCwgJG1vZGFsLCB0b2FzdHIpIHtcclxuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG4gICAgICAgIHZhciBjaG9pY2VzID1cclxuICAgICAgICAgICAgW1xyXG4gICAgICAgICAgICB7IGlkOiAxLCBuYW1lOiBcIlJlZ2lzdGVyXCIsIGNvbW1hbmQ6IGZ1bmN0aW9uIChlKSB7IGN0cmwucmVnaXN0ZXJHdWVzdChlKSB9LCBpY29uOiAnaWNvbiBpb24ta2V5JywgZGVmYXVsdDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkOiAyLCBuYW1lOiBcIk1haWwgVGlja2V0XCIsIGNvbW1hbmQ6IGZ1bmN0aW9uIChlKSB7IGN0cmwuc2VuZE1haWwoZSkgfSwgaWNvbjogJ2ljb24gaW9uLWFuZHJvaWQtbWFpbCcsIGRlZmF1bHQ6IGZhbHNlIH0sXHJcbiAgICAgICAgICAgIHsgaWQ6IDMsIG5hbWU6IFwiQ2FuY2VsXCIsIGNvbW1hbmQ6IGZ1bmN0aW9uIChlKSB7IGN0cmwuY2FuY2VsUmVnaXN0cmF0aW9uKGUpIH0sIGljb246ICdpY29uIGlvbi1hbmRyb2lkLWNhbmNlbCcsIGRlZmF1bHQ6IGZhbHNlIH0sXHJcbiAgICAgICAgICAgIHsgaWQ6IDQsIG5hbWU6IFwiR3Vlc3QgTGlzdFwiLCBjb21tYW5kOiBmdW5jdGlvbiAoZSkgeyBjdHJsLnJlc2VydmF0aW9uT3ZlcnJpZGUoZSkgfSwgaWNvbjogJ2ljb24gaW9uLWFuZHJvaWQtYWRkLWNpcmNsZScsIGRlZmF1bHQ6IGZhbHNlIH0sXHJcbiAgICAgICAgICAgIHsgaWQ6IDUsIG5hbWU6IFwiQWRkIFRpY2tldHNcIiwgY29tbWFuZDogZnVuY3Rpb24gKGUpIHsgY3RybC5yZWdpc3Rlckd1ZXN0KGUpIH0sIGljb246ICdpY29uIGlvbi1hbmRyb2lkLWFkZC1jaXJjbGUnLCBkZWZhdWx0OiBmYWxzZSB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICBcclxuICAgICAgICBjdHJsLnRpdGxlID0gJ1Jlc2VydmF0aW9uIE1hbmFnZXInO1xyXG4gICAgICAgIGN0cmwuZGVzY3JpcHRpb24gPSBcIk1hbmFnZSBHdWVzdCBMaXN0XCI7XHJcblxyXG4gICAgICAgIGN0cmwuc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHQsXHJcbiAgICAgICAgICAgIG9yZGVyQnk6ICdpZCcsXHJcbiAgICAgICAgICAgIG9yZGVyRGlyZWN0aW9uOiAnYXNjJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGN0cmwuJG9uQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5zZWFyY2goKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2d1ZXN0IGxpc3QgaW5pdCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5yZXNldFNlYXJjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LFxyXG4gICAgICAgICAgICAgICAgb3JkZXJCeTogJ2lkJyxcclxuICAgICAgICAgICAgICAgIG9yZGVyRGlyZWN0aW9uOiAnYXNjJ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjdHJsLnF1aWNrRmlsdGVyID0gbnVsbDtcclxuICAgICAgICAgICAgY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLnNlYXJjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoY3RybC5ldmVudElkID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvZXZlbnQvJyArIGN0cmwuZXZlbnRJZCArICcvZ3Vlc3RzJywgeyBwYXJhbXM6IGN0cmwuc2VhcmNoTW9kZWwgfSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbCA9IHIuZGF0YTtcclxuICAgICAgICAgICAgICAgIGN0cmwuZ3Vlc3RzID0gW107XHJcbiAgICAgICAgICAgICAgICByLmRhdGEucmVzdWx0cy5tYXAoZnVuY3Rpb24gKGd1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3Vlc3QuY2hvaWNlcyA9IGJ1aWxkR3Vlc3RPcHRpb25zKGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmd1ZXN0cy5wdXNoKGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGN0cmwuc2VhcmNoTW9kZWwucmVzdWx0cztcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBjdHJsLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN0cmwucGFnZWQgPSBmdW5jdGlvbiBwYWdlZCgpIHtcclxuICAgICAgICAgICAgY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY3RybC5xdWlja0ZpbHRlckNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5wYWdlID0gMTtcclxuICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSBudWxsO1xyXG4gICAgICAgICAgICBjdHJsLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gbnVsbDtcclxuICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5pc0F0dGVuZGluZyA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBjdHJsLnNob3dTZW5kTWFpbCA9IG51bGw7IFxyXG4gICAgICAgICAgICBjdHJsLnNob3dTZW5kV2FpdGluZyA9IG51bGw7IFxyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChjdHJsLnF1aWNrRmlsdGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdXYWl0aW5nQW5kTm90U2VudCc6XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuc2VhcmNoTW9kZWwuaXNNYWlsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNob3dTZW5kV2FpdGluZyA9IHRydWU7IFxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnV2FpdGluZ0FuZFNlbnQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuc2VhcmNoTW9kZWwuaXNXYWl0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gdHJ1ZTs7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdUaWNrZXROb3RTZW50JzpcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNlYXJjaE1vZGVsLmlzQXR0ZW5kaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNlYXJjaE1vZGVsLmlzTWFpbGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNob3dTZW5kTWFpbCA9IHRydWU7IFxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnVGlja2V0U2VudCc6XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5pc0F0dGVuZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5pc01haWxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZWFyY2hNb2RlbC5pc1dhaXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLnJlc2VydmF0aW9uT3ZlcnJpZGUgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvZXZlbnQvJyArIGN0cmwuZXZlbnRJZCArICcvcmVnaXN0ZXIvJywgZSkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGd1ZXN0ID0gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgZ3Vlc3QuY2hvaWNlcyA9IGJ1aWxkR3Vlc3RPcHRpb25zKGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGUsIGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCdSZWdpc3RlcmVkICcgKyBndWVzdC5uYW1lKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcgcmVnaXN0ZXJpbmcgZ3Vlc3QnLCBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLmNhbmNlbFJlZ2lzdHJhdGlvbiA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJ2FwaS9ldmVudC8nICsgY3RybC5ldmVudElkICsgJy9jYW5jZWxyZWdpc3Rlci8nICsgZS5pZCkudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGd1ZXN0ID0gci5kYXRhO1xyXG4gICAgICAgICAgICAgICAgZ3Vlc3QuY2hvaWNlcyA9IGJ1aWxkR3Vlc3RPcHRpb25zKGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGUsIGd1ZXN0KTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCdDYW5jZWxlZCByZWdpc3RyYXRpb24gZm9yICcgKyBndWVzdC5uYW1lKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcgY2FuY2VsbGluZyByZWdpc3RyYXRpb24nLCBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLnJlZ2lzdGVyR3Vlc3QgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgbmV3R3Vlc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKCFlKSB7XHJcbiAgICAgICAgICAgICAgICBlID0geyBpZDogbnVsbCwgZXZlbnRJZDogY3RybC5ldmVudElkIH1cclxuICAgICAgICAgICAgICAgIG5ld0d1ZXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnZ3Vlc3RFZGl0JyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3Vlc3RJZDogZS5pZCxcclxuICAgICAgICAgICAgICAgICAgICBldmVudElkOiBlLmV2ZW50SWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5jaG9pY2VzID0gYnVpbGRHdWVzdE9wdGlvbnMocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGUsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3R3Vlc3QpIGN0cmwuZ3Vlc3RzLnVuc2hpZnQoZSk7XHJcbiAgICAgICAgICAgICAgICB0b2FzdHIuaW5mbygnUmVnaXN0ZXJlZCAnICsgcmVzdWx0Lm5hbWUpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5zZW5kTWFpbCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJ2FwaS9ldmVudC8nICsgY3RybC5ldmVudElkICsgJy9tYWlsdGlja2V0LycgKyBlLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3Vlc3QgPSByLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBndWVzdC5jaG9pY2VzID0gYnVpbGRHdWVzdE9wdGlvbnMoZ3Vlc3QpO1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoZSwgZ3Vlc3QpO1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoJ01haWxlZCB0aWNrZXQgZm9yICcgKyBndWVzdC5uYW1lKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcgbWFpbGluZyB0aWNrZXQnLCBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLnNlbmRBbGxNYWlsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJ2FwaS9ldmVudC8nICsgY3RybC5ldmVudElkICsgJy9zZW5kYWxsdGlja2V0cycpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCdNYWlsZWQgYWxsIHRpY2tldHMnKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ09vcHMuIFNvbWV0aGluZyB3ZW50IHdyb25nJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcgbWFpbGluZyB0aWNrZXRzJywgZXJyLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5zZW5kQWxsV2FpdGluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL2V2ZW50LycgKyBjdHJsLmV2ZW50SWQgKyAnL3NlbmRhbGx3YWl0aW5nJykudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoJ01haWxlZCBhbGwgbGV0dGVycycpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcnLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZyBtYWlsaW5nIGxldHRlcnMnLCBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjdHJsLmV4cG9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL2V2ZW50LycgKyBjdHJsLmV2ZW50SWQgKyAnL2d1ZXN0cy9leHBvcnQnLCB7IHBhcmFtczogY3RybC5zZWFyY2hNb2RlbCB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudFR5cGUgPSBkYXRhLmhlYWRlcnMoKVsnY29udGVudC10eXBlJ107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gZGF0YS5oZWFkZXJzKClbJ3gtZmlsZW5hbWUnXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmtFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2RhdGEuZGF0YV0sIHsgdHlwZTogY29udGVudFR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsIHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGZpbGVuYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGlja0V2ZW50ID0gbmV3IE1vdXNlRXZlbnQoXCJjbGlja1wiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZpZXdcIjogd2luZG93LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJidWJibGVzXCI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNhbmNlbGFibGVcIjogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtFbGVtZW50LmRpc3BhdGNoRXZlbnQoY2xpY2tFdmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY3RybC5pbXBvcnQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnZ3Vlc3RJbXBvcnQnLFxyXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBldmVudElkOiBjdHJsLmV2ZW50SWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuc2VhcmNoKHRhYmxlU3RhdGVSZWYpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYnVpbGRHdWVzdE9wdGlvbnMoZ3Vlc3QpIHtcclxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmIChndWVzdC5jYW5SZWdpc3Rlcikgb3B0aW9ucy5wdXNoKGNob2ljZXNbMF0pO1xyXG4gICAgICAgICAgICBpZiAoZ3Vlc3QuY2FuTWFpbCkgb3B0aW9ucy5wdXNoKGNob2ljZXNbMV0pO1xyXG4gICAgICAgICAgICBpZiAoZ3Vlc3QuY2FuQWRkVG9BdHRlbmRpbmcpIG9wdGlvbnMucHVzaChjaG9pY2VzWzNdKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChndWVzdC5jYW5BZGRUaWNrZXRzKSBvcHRpb25zLnB1c2goY2hvaWNlc1s0XSk7XHJcbiAgICAgICAgICAgIGlmIChndWVzdC5jYW5DYW5jZWwpIG9wdGlvbnMucHVzaChjaG9pY2VzWzJdKTtcclxuXHJcbiAgICAgICAgICAgIGd1ZXN0LnByaW1hcnlDaG9pY2UgPSBhbmd1bGFyLmNvcHkob3B0aW9uc1swXSk7XHJcbiAgICAgICAgICAgIG9wdGlvbnMuc2hpZnQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBtb2R1bGUuY29tcG9uZW50KCdndWVzdExpc3QnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgIGV2ZW50SWQ6ICc8J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9ldmVudHMvZ3Vlc3QtbGlzdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgJ3RvYXN0cicsIGd1ZXN0TGlzdENvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcblxyXG59XHJcbikoKTsiLCIvL21haWxlci1saXN0LmNvbXBvbmVudC5qc1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCB0b2FzdHIsICRtb2RhbCkge1xyXG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xyXG5cclxuICAgICAgICAkY3RybC50aXRsZSA9ICdNYXJrSXQgTWFuYWdlcic7XHJcbiAgICAgICAgJGN0cmwuc3ViVGl0bGUgPSAnTWFpbGVycyc7XHJcblxyXG4gICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LFxyXG4gICAgICAgICAgICAvL29yZGVyQnk6ICdjYW1wYWlnbklkJyxcclxuICAgICAgICAgICAgLy9vcmRlckRpcmVjdGlvbjogJ2Rlc2MnLFxyXG4gICAgICAgICAgICBzdXBwcmVzczogZmFsc2VcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFpbCBsaXN0IGluaXQnKTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvbWFpbGVyL2NhbXBhaWducycpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmNhbXBhaWducyA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL21haWxlci9yZWFzb25zJykudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgJGN0cmwucmVhc29ucyA9IHIuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5kb3dubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL21haWxlci9leHBvcnQnLCAkY3RybC5zZWFyY2hNb2RlbClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRUeXBlID0gZGF0YS5oZWFkZXJzKClbJ2NvbnRlbnQtdHlwZSddO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IGRhdGEuaGVhZGVycygpWyd4LWZpbGVuYW1lJ107XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5rRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtkYXRhLmRhdGFdLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB1cmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBmaWxlbmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xpY2tFdmVudCA9IG5ldyBNb3VzZUV2ZW50KFwiY2xpY2tcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2aWV3XCI6IHdpbmRvdyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYnViYmxlc1wiOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjYW5jZWxhYmxlXCI6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5kaXNwYXRjaEV2ZW50KGNsaWNrRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdPb3BzICcgKyBleC5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGUpICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbC5vcmRlckJ5ID0gdGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsLm9yZGVyRGlyZWN0aW9uID0gdGFibGVTdGF0ZS5zb3J0LnJldmVyc2UgPyAnZGVzYycgOiAnYXNjJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCRjdHJsLnNlYXJjaE1vZGVsLnN1cHByZXNzID09PSBudWxsKSAkY3RybC5zZWFyY2hNb2RlbC5zdXBwcmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCdhcGkvbWFpbGVyJywgeyBwYXJhbXM6ICRjdHJsLnNlYXJjaE1vZGVsIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1haWxlcnMgPSByLmRhdGEucmVzdWx0cztcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHIuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgJGN0cmwuc2VhcmNoTW9kZWwucmVzdWx0cztcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT29wcycsIGVyci5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcignT29wcyAnICsgZXJyLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuc2hvd1VwbG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnbWFpbGVyVXBsb2FkJyxcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXHJcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIHRvYXN0ci5pbmZvKCdVcGxvYWRlZCAnICsgcmVzdWx0LnRpdGxlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRjdHJsLnBhZ2VkID0gZnVuY3Rpb24gcGFnZWQoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkY3RybC50b2dnbGVGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLnNob3dTdXBwcmVzcyA9ICEkY3RybC5zaG93U3VwcHJlc3M7XHJcbiAgICAgICAgICAgICRjdHJsLnNlYXJjaE1vZGVsLnN1cHByZXNzID0gJGN0cmwuc2hvd1N1cHByZXNzO1xyXG4gICAgICAgICAgICAkY3RybC5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC50b2dnbGVTdXBwcmVzcyA9IGZ1bmN0aW9uIChtYWlsZXIpIHtcclxuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTsgXHJcbiAgICAgICAgICAgIGlmIChtYWlsZXIuc3VwcHJlc3MpIHtcclxuICAgICAgICAgICAgICAgIG1haWxlci5zdXBwcmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbWFpbGVyLnJlYXNvbklkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KCdhcGkvbWFpbGVyJywgbWFpbGVyKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQobWFpbGVyLCByLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgbWFpbGVyJywgZXJyLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICR0b2FzdHIuZXJyb3IoJ09vcHMgJyArIGVyci5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdtYWlsZXJTdXBwcmVzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpbGVyOiBtYWlsZXJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcclxuICAgICAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChtYWlsZXIsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1NhdmVkICcgKyByZXN1bHQuZmlyc3ROYW1lICsgJyAnICsgcmVzdWx0Lmxhc3ROYW1lKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlOyBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbWFpbGVyTGlzdCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tYWlsZXJzL21haWxlci1saXN0LmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICd0b2FzdHInLCAnJHVpYk1vZGFsJywgY29udHJvbGxlcl1cclxuICAgICAgICB9KTtcclxufVxyXG4pKCk7IiwiLy9tYWlsZXItc3VwcHJlc3MuY29tcG9uZW50LmpzXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHApIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWFpbGVyIHN1cHByZXNzIGluaXQnKTtcclxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLm1haWxlciA9ICRjdHJsLnJlc29sdmUubWFpbGVyO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAkY3RybC5tYWlsZXIuZmlyc3ROYW1lICsgJyAnICsgJGN0cmwubWFpbGVyLmxhc3ROYW1lO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9tYWlsZXIvcmVhc29ucycpLnRoZW4oZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnJlYXNvbnMgPSByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTsgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5tYWlsZXIuc3VwcHJlc3MgPSB0cnVlOyBcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnYXBpL21haWxlcicsICRjdHJsLm1haWxlcikudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJGN0cmwubWFpbGVyLCByLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZSgkY3RybC5tYWlsZXIpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igc2F2aW5nIG1haWxlcicsIGVyci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnbWFpbGVyU3VwcHJlc3MnLFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbWFpbGVycy9tYWlsZXItc3VwcHJlc3MuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICc8JyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsIGNvbnRyb2xsZXJdXHJcbiAgICAgICAgfSk7XHJcbn1cclxuKSgpOyIsIi8vbWFpbGVyLXVwbG9hZC5jb21wb25lbnQuanNcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZm9ybURhdGFPYmplY3QoZGF0YSkge1xyXG4gICAgICAgIHZhciBmZCA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgIGZkLmFwcGVuZCgnZmlsZScsIGRhdGEpO1xyXG4gICAgICAgIHJldHVybiBmZDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCB0b2FzdHIpIHtcclxuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xyXG4gICAgICAgICRjdHJsLnRpdGxlID0gJ01haWxlciBVcGxvYWQnO1xyXG5cclxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTWFpbGVyIFVwbG9hZCBJbml0Jyk7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL21haWxlci9jYW1wYWlnbnMnKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5jYW1wYWlnbnMgPSByLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkY3RybC5maWxlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAkY3RybC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC5maWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoJGZpbGUsICRldmVudCkge1xyXG4gICAgICAgICAgICAkY3RybC5yZXN1bHQgPSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRjdHJsLnNhdmVDYW1wYWlnbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL21haWxlci9jcmVhdGVjYW1wYWlnbicsICRjdHJsLmNhbXBhaWduKS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5jYW1wYWlnbnMudW5zaGlmdChyLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgJGN0cmwuc2VsZWN0ZWRDYW1wYWlnbiA9IHIuZGF0YTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnNob3dDcmVhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdPb3BzICcgKyBlcnIuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkY3RybC51cGxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgICRjdHJsLnJlc3VsdCA9IHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGlkID0gJGN0cmwuc2VsZWN0ZWRDYW1wYWlnbi5pZDsgXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnYXBpL2ZpbGUvbWFpbGVyLycgKyBpZCwgZm9ybURhdGFPYmplY3QoJGN0cmwuZmlsZSksIHtcclxuICAgICAgICAgICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHksXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWQgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5yZXN1bHQuc3VjY2VzcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5yZXN1bHQubWVzc2FnZSA9IHIuZGF0YS5tZXNzYWdlWzBdO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnJlc3VsdC5tZXNzYWdlID0gZXJyb3IuZGF0YS5tZXNzYWdlO1xyXG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRjdHJsLmZpbGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRjdHJsLnJlc3VsdC5jYW1wYWlnbnMgPSAkY3RybC5jYW1wYWlnbnM7XHJcbiAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLnJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy9zZXJ2aWNlLm1haWxlcih2bS5zZWxlY3RlZENhbXBhaWduLmlkLCB2bS5maWxlKVxyXG4gICAgICAgICAgICAvLyAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgJGN0cmwucmVzdWx0LnN1Y2Nlc3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgJGN0cmwucmVzdWx0Lm1lc3NhZ2UgPSBkYXRhO1xyXG4gICAgICAgICAgICAvLyAgICB9KVxyXG4gICAgICAgICAgICAvLyAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAkY3RybC5yZXN1bHQubWVzc2FnZSA9IGVycm9yLmRhdGEubWVzc2FnZTtcclxuICAgICAgICAgICAgLy8gICAgfSlcclxuICAgICAgICAgICAgLy8gICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgJGN0cmwuZmlsZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgLy8gICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgJGN0cmwucmVzdWx0LmNhbXBhaWducyA9ICRjdHJsLmNhbXBhaWducztcclxuICAgICAgICAgICAgLy8gICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2UoJGN0cmwucmVzdWx0KTtcclxuICAgICAgICAgICAgLy8gICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1vZHVsZS5jb21wb25lbnQoJ21haWxlclVwbG9hZCcsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICc8JyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcclxuICAgICAgICAgICAgICAgIGNsb3NlOiAnJicsXHJcbiAgICAgICAgICAgICAgICBkaXNtaXNzOiAnJicsXHJcbiAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbWFpbGVycy9tYWlsZXItdXBsb2FkLmNvbXBvbmVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICd0b2FzdHInLCBjb250cm9sbGVyXVxyXG4gICAgICAgIH0pO1xyXG5cclxufVxyXG4pKCk7Il19
